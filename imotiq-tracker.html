<!DOCTYPE html>
<html lang="bg">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ImotIQ ‚Äî –ö–≤–∞—Ä—Ç–∞–ª–µ–Ω –¢—Ä–µ–∫–µ—Ä</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=DM+Sans:ital,wght@0,300;0,400;0,500;1,300&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
<style>
  :root {
    --gold: #C9A84C; --gold-light: #E8C97A; --gold-dim: rgba(201,168,76,0.12);
    --dark: #0A0A0F; --dark-2: #111118; --dark-3: #1A1A24; --dark-4: #22222E;
    --cream: #F5F0E8; --cream-dim: #D4CCB8;
    --green: #2ECC8A; --green-dim: rgba(46,204,138,0.12);
    --red: #E84C4C; --red-dim: rgba(232,76,76,0.12);
    --accent: #4C7AC9; --accent-dim: rgba(76,122,201,0.12);
    --sidebar: 260px;
  }
  * { margin:0; padding:0; box-sizing:border-box; }
  body { background:var(--dark); color:var(--cream); font-family:'DM Sans',sans-serif; display:flex; min-height:100vh; cursor:auto; }

  .cursor { width:10px; height:10px; background:var(--gold); border-radius:50%; position:fixed; pointer-events:none; z-index:9999; transition:transform 0.15s; mix-blend-mode:difference; }
  .cursor-ring { width:32px; height:32px; border:1px solid rgba(201,168,76,0.5); border-radius:50%; position:fixed; pointer-events:none; z-index:9998; transition:all 0.08s; }

  /* SIDEBAR */
  .sidebar { width:var(--sidebar); min-height:100vh; background:var(--dark-2); border-right:1px solid rgba(255,255,255,0.05); display:flex; flex-direction:column; position:fixed; top:0; left:0; bottom:0; z-index:50; }
  .sidebar-logo { padding:28px 24px 24px; border-bottom:1px solid rgba(255,255,255,0.05); font-family:'Syne',sans-serif; font-weight:800; font-size:1.4rem; }
  .sidebar-logo span { color:var(--gold); }
  .sidebar-section { padding:20px 16px 8px; font-size:0.62rem; text-transform:uppercase; letter-spacing:0.14em; color:rgba(212,204,184,0.3); }
  .nav-item { display:flex; align-items:center; gap:12px; padding:10px 16px; margin:2px 8px; border-radius:8px; cursor:auto; transition:all 0.2s; color:var(--cream-dim); font-size:0.88rem; text-decoration:none; position:relative; }
  .nav-item:hover { background:rgba(255,255,255,0.04); color:var(--cream); }
  .nav-item.active { background:var(--gold-dim); color:var(--gold); }
  .nav-item.active::before { content:''; position:absolute; left:-8px; top:50%; transform:translateY(-50%); width:3px; height:60%; background:var(--gold); border-radius:0 3px 3px 0; }
  .nav-icon { width:18px; font-size:1rem; text-align:center; }
  .nav-badge { margin-left:auto; background:var(--gold); color:var(--dark); font-size:0.6rem; font-weight:700; padding:2px 7px; border-radius:100px; font-family:'Syne',sans-serif; }
  .sidebar-bottom { margin-top:auto; padding:16px; border-top:1px solid rgba(255,255,255,0.05); }
  .plan-widget { background:var(--gold-dim); border:1px solid rgba(201,168,76,0.2); border-radius:10px; padding:14px; margin-bottom:12px; }
  .plan-name { font-family:'Syne',sans-serif; font-weight:700; font-size:0.75rem; color:var(--gold); margin-bottom:4px; }
  .plan-usage { font-size:0.72rem; color:var(--cream-dim); margin-bottom:8px; }
  .usage-bar { height:3px; background:rgba(255,255,255,0.08); border-radius:3px; overflow:hidden; }
  .usage-fill { height:100%; background:var(--gold); border-radius:3px; }
  .upgrade-btn { display:block; text-align:center; padding:8px; background:var(--gold); color:var(--dark); border-radius:6px; font-family:'Syne',sans-serif; font-weight:700; font-size:0.72rem; text-decoration:none; margin-top:10px; cursor:auto; transition:background 0.2s; }
  .upgrade-btn:hover { background:var(--gold-light); }
  .user-row { display:flex; align-items:center; gap:10px; }
  .avatar { width:34px; height:34px; background:linear-gradient(135deg,var(--gold),#8B6A1F); border-radius:50%; display:flex; align-items:center; justify-content:center; font-family:'Syne',sans-serif; font-weight:700; font-size:0.8rem; color:var(--dark); flex-shrink:0; }
  .user-name { font-size:0.82rem; font-weight:500; }
  .user-plan { font-size:0.7rem; color:var(--cream-dim); }
  .logout-btn { margin-left:auto; background:none; border:none; color:rgba(212,204,184,0.3); cursor:auto; font-size:0.8rem; transition:color 0.2s; }
  .logout-btn:hover { color:var(--red); }

  /* MAIN */
  .main { margin-left:var(--sidebar); flex:1; display:flex; flex-direction:column; }
  .topbar { padding:20px 36px; border-bottom:1px solid rgba(255,255,255,0.05); display:flex; align-items:center; justify-content:space-between; background:var(--dark); position:sticky; top:0; z-index:40; }
  .page-title { font-family:'Syne',sans-serif; font-weight:700; font-size:1.1rem; }
  .topbar-right { display:flex; align-items:center; gap:12px; }
  .notif-btn { width:36px; height:36px; background:var(--dark-3); border:1px solid rgba(255,255,255,0.06); border-radius:8px; display:flex; align-items:center; justify-content:center; cursor:auto; font-size:1rem; position:relative; transition:border-color 0.2s; }
  .notif-btn:hover { border-color:rgba(201,168,76,0.3); }
  .notif-dot { position:absolute; top:6px; right:6px; width:7px; height:7px; background:var(--gold); border-radius:50%; border:1.5px solid var(--dark); }

  .content { padding:32px 36px; flex:1; }

  /* FILTER BAR */
  .filter-bar {
    display:flex; align-items:center; gap:12px; margin-bottom:28px; flex-wrap:wrap;
  }
  .filter-label { font-size:0.75rem; color:var(--cream-dim); margin-right:4px; }
  .filter-btn {
    padding:8px 16px; border-radius:6px; border:1px solid rgba(255,255,255,0.08);
    background:none; color:var(--cream-dim); font-size:0.8rem; cursor:auto;
    transition:all 0.2s; font-family:'DM Sans',sans-serif;
  }
  .filter-btn:hover { border-color:rgba(201,168,76,0.3); color:var(--cream); }
  .filter-btn.active { background:var(--gold-dim); border-color:rgba(201,168,76,0.4); color:var(--gold); }
  .filter-sep { width:1px; height:24px; background:rgba(255,255,255,0.07); margin:0 4px; }

  /* MAIN CHART CARD */
  .chart-card {
    background:var(--dark-3); border:1px solid rgba(255,255,255,0.06);
    border-radius:16px; padding:28px; margin-bottom:20px;
    position:relative; overflow:hidden;
  }
  .chart-card::before { content:''; position:absolute; top:0; left:0; right:0; height:2px; background:linear-gradient(90deg,var(--gold),transparent); }
  .chart-header { display:flex; justify-content:space-between; align-items:flex-start; margin-bottom:24px; }
  .chart-title { font-family:'Syne',sans-serif; font-weight:700; font-size:1rem; margin-bottom:4px; }
  .chart-sub { font-size:0.76rem; color:var(--cream-dim); }
  .chart-legend { display:flex; gap:16px; }
  .legend-item { display:flex; align-items:center; gap:6px; font-size:0.75rem; color:var(--cream-dim); }
  .legend-dot { width:8px; height:8px; border-radius:50%; }


  /* DISTRICT CHIPS */
  .chips-wrap {
    overflow-x: auto; display:flex; gap:8px; padding-bottom:4px;
    margin-bottom:20px; scrollbar-width:thin;
    scrollbar-color: rgba(201,168,76,0.2) transparent;
  }
  .chips-wrap::-webkit-scrollbar { height:3px; }
  .chips-wrap::-webkit-scrollbar-track { background:transparent; }
  .chips-wrap::-webkit-scrollbar-thumb { background:rgba(201,168,76,0.2); border-radius:3px; }
  .chip {
    display:inline-flex; align-items:center; gap:6px;
    padding:7px 14px; border-radius:100px; border:1px solid rgba(255,255,255,0.08);
    background:none; color:var(--cream-dim); font-size:0.78rem;
    cursor:auto; white-space:nowrap; transition:all 0.2s;
    font-family:'DM Sans',sans-serif;
  }
  .chip:hover { border-color:rgba(201,168,76,0.3); color:var(--cream); }
  .chip.active { color:var(--dark); font-weight:600; border-color:transparent; }
  .chip-dot { width:7px; height:7px; border-radius:50%; }

  /* DISTRICT GRID */
  .district-grid { display:grid; grid-template-columns:repeat(3,1fr); gap:12px; margin-bottom:20px; }
  .district-card {
    background:var(--dark-3); border:1px solid rgba(255,255,255,0.05);
    border-radius:12px; padding:20px; cursor:auto;
    transition:all 0.25s; position:relative; overflow:hidden;
  }
  .district-card:hover { border-color:rgba(201,168,76,0.25); transform:translateY(-2px); }
  .district-card.selected { border-color:rgba(201,168,76,0.5); background:rgba(201,168,76,0.05); }
  .district-card::after { content:''; position:absolute; bottom:0; left:0; right:0; height:2px; background:var(--dcolor,var(--gold)); opacity:0.4; }
  .d-name { font-family:'Syne',sans-serif; font-weight:700; font-size:0.9rem; margin-bottom:12px; }
  .d-price { font-family:'Syne',sans-serif; font-weight:800; font-size:1.5rem; line-height:1; }
  .d-unit { font-size:0.72rem; color:var(--cream-dim); margin-bottom:8px; }
  .d-trend { display:inline-flex; align-items:center; gap:4px; font-size:0.75rem; font-weight:500; padding:3px 8px; border-radius:100px; }
  .d-trend.up { background:var(--green-dim); color:var(--green); }
  .d-trend.down { background:var(--red-dim); color:var(--red); }
  .d-trend.flat { background:rgba(255,255,255,0.05); color:var(--cream-dim); }
  .d-mini-chart { margin-top:14px; height:36px; }

  /* BOTTOM ROW */
  .bottom-row { display:grid; grid-template-columns:1fr 1fr; gap:16px; }
  .panel { background:var(--dark-3); border:1px solid rgba(255,255,255,0.05); border-radius:12px; overflow:hidden; }
  .panel-header { padding:18px 22px; border-bottom:1px solid rgba(255,255,255,0.05); display:flex; align-items:center; justify-content:space-between; }
  .panel-title { font-family:'Syne',sans-serif; font-weight:700; font-size:0.9rem; }
  .panel-action { font-size:0.74rem; color:var(--gold); cursor:auto; text-decoration:none; }

  /* TOP LIST */
  .top-item { display:flex; align-items:center; gap:14px; padding:13px 22px; border-bottom:1px solid rgba(255,255,255,0.03); transition:background 0.2s; }
  .top-item:last-child { border-bottom:none; }
  .top-item:hover { background:rgba(255,255,255,0.02); }
  .top-rank { font-family:'Syne',sans-serif; font-weight:800; font-size:0.8rem; color:rgba(212,204,184,0.3); width:20px; text-align:center; }
  .top-info { flex:1; }
  .top-name { font-size:0.84rem; font-weight:500; }
  .top-sub { font-size:0.72rem; color:var(--cream-dim); }
  .top-price { font-family:'Syne',sans-serif; font-weight:700; font-size:0.88rem; color:var(--gold); }
  .top-change { font-size:0.72rem; text-align:right; }
  .top-change.up { color:var(--green); }
  .top-change.down { color:var(--red); }

  /* HEATMAP */
  .heatmap-grid { display:grid; grid-template-columns:repeat(6,1fr); gap:4px; padding:20px; }
  .heat-cell {
    aspect-ratio:1; border-radius:4px; display:flex; align-items:center; justify-content:center;
    font-size:0.55rem; font-weight:600; cursor:auto; transition:transform 0.2s;
    color:var(--dark); font-family:'Syne',sans-serif;
  }
  .heat-cell:hover { transform:scale(1.15); z-index:1; position:relative; }

  @keyframes fadeUp { from{opacity:0;transform:translateY(20px)} to{opacity:1;transform:translateY(0)} }
  .fade-in { animation:fadeUp 0.5s ease both; }

  /* ‚îÄ‚îÄ MOBILE RESPONSIVE ‚îÄ‚îÄ */
  .mobile-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.7);z-index:49;backdrop-filter:blur(4px);}
  .burger{display:none;flex-direction:column;gap:5px;cursor:auto;padding:8px;background:var(--dark-3);border:1px solid rgba(255,255,255,0.08);border-radius:8px;}
  .burger span{display:block;width:20px;height:2px;background:var(--cream);border-radius:2px;transition:all 0.3s;}
  .burger.open span:nth-child(1){transform:translateY(7px) rotate(45deg);}
  .burger.open span:nth-child(2){opacity:0;}
  .burger.open span:nth-child(3){transform:translateY(-7px) rotate(-45deg);}

  @media(max-width:900px){
    .sidebar{transform:translateX(-100%);transition:transform 0.3s ease;box-shadow:none;}
    .sidebar.open{transform:translateX(0);box-shadow:8px 0 40px rgba(0,0,0,0.5);}
    .mobile-overlay.show{display:block;}
    .main{margin-left:0 !important;}
    .burger{display:flex;}
    .content{padding:20px 16px !important;}
    .topbar{padding:14px 16px !important;}
    /* Stack grids on mobile */
    .stats-grid,.summary-grid,.hero-stats{grid-template-columns:1fr 1fr !important;}
    .bottom-grid,.main-grid,.comparison,.bottom-row{grid-template-columns:1fr !important;}
    .calc-layout,.settings-layout{grid-template-columns:1fr !important;}
    .district-grid{grid-template-columns:1fr 1fr !important;}
    .forecast-grid{grid-template-columns:1fr 1fr !important;}
    .alert-form{grid-template-columns:1fr 1fr !important;}
    .alert-main{grid-template-columns:auto 1fr !important;}
    .alert-stats,.alert-actions{display:none !important;}
    .plans-grid{grid-template-columns:1fr !important;}
    .chart-header{flex-direction:column !important;gap:12px !important;}
    .url-row,.url-input-wrap{flex-wrap:wrap !important;}
    .url-inp,.url-input{border-right:1px solid rgba(201,168,76,0.15) !important;border-radius:8px !important;margin-bottom:8px !important;width:100% !important;}
    .scan-btn,.analyze-btn{border-radius:8px !important;width:100% !important;justify-content:center !important;}
    .infra-grid{grid-template-columns:repeat(3,1fr) !important;}
    .chips-wrap{padding-bottom:8px !important;}
  }
  @media(max-width:500px){
    .stats-grid,.summary-grid,.hero-stats{grid-template-columns:1fr !important;}
    .district-grid,.forecast-grid{grid-template-columns:1fr !important;}
    .score-overview{grid-template-columns:1fr !important;}
    .score-main{border-right:none !important;border-bottom:1px solid rgba(255,255,255,0.05) !important;}
    .checks-grid{grid-template-columns:1fr !important;}
  }

  /* ‚îÄ‚îÄ PAGE TRANSITIONS ‚îÄ‚îÄ */
  body{opacity:0;animation:pageIn 0.35s ease forwards;}
  @keyframes pageIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
  .page-exit{animation:pageOut 0.25s ease forwards !important;}
  @keyframes pageOut{to{opacity:0;transform:translateY(-8px)}}

  /* ‚îÄ‚îÄ CURSOR FIX ‚îÄ‚îÄ */
  *, *::before, *::after { cursor: auto !important; }
  .cursor { cursor: auto !important; }
  @media (max-width: 900px) {
    *, *::before, *::after { cursor: auto !important; }
    .cursor, .cursor-ring { display: none !important; }
  }


  /* ‚îÄ‚îÄ SIDEBAR SCROLL FIX ‚îÄ‚îÄ */
  .sidebar {
    overflow-y: auto !important;
    overflow-x: hidden !important;
  }
  .sidebar::-webkit-scrollbar { width: 3px; }
  .sidebar::-webkit-scrollbar-track { background: transparent; }
  .sidebar::-webkit-scrollbar-thumb { background: rgba(201,168,76,0.2); border-radius: 3px; }
  .sidebar-bottom {
    position: sticky !important;
    bottom: 0 !important;
    background: var(--dark-2) !important;
    z-index: 2 !important;
    border-top: 1px solid rgba(255,255,255,0.05) !important;
  }


  /* ‚îÄ‚îÄ CURSOR OVERRIDE ‚îÄ‚îÄ */
  *, *::before, *::after { cursor: auto !important; }
  .cursor, .cursor-ring { display: none !important; }
  a, button, [onclick], select, input, label { cursor: pointer !important; }
</style>

  <!-- ImotIQ Config -->
  <script>
    const IMOTIQ_CONFIG = {
      BACKEND_URL: 'https://script.google.com/macros/s/AKfycbxcTo_rUU30jxQhl5orNtHFJaWpkemiuzAc0ilhciL7y7eEJ33YZ7SWx51XkgTr0zgMfw/exec',
      VERSION: '1.0',
    };

    // ‚îÄ‚îÄ API HELPER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    async function apiCall(action, data = {}) {
      try {
        const res = await fetch(IMOTIQ_CONFIG.BACKEND_URL, {
          method: 'POST',
          body: JSON.stringify({ action, ...data }),
        });
        return await res.json();
      } catch(e) {
        console.error('API error:', e);
        return { success: false, error: e.message };
      }
    }

    // ‚îÄ‚îÄ SESSION ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function getSession() { return localStorage.getItem('imotiq_session'); }
    function getUser()    { return JSON.parse(localStorage.getItem('imotiq_user') || 'null'); }

    function checkSession() {
      if(!getSession() && !window.location.href.includes('landing')) {
        window.location.href = 'imotiq-landing.html';
      }
    }

    // ‚îÄ‚îÄ LOGOUT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    async function logout() {
      await apiCall('logout', { sessionId: getSession() });
      localStorage.clear();
      window.location.href = 'imotiq-landing.html';
    }
  </script>

</head>
<body>
<script>
    // ‚îÄ‚îÄ –ü–†–û–í–ï–†–ö–ê –ù–ê –°–ï–°–ò–Ø ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    (function() {
      var sess = localStorage.getItem('imotiq_session');
      var user = JSON.parse(localStorage.getItem('imotiq_user') || 'null');
      // –ê–∫–æ –Ω—è–º–∞ —Å–µ—Å–∏—è –∏–ª–∏ –µ —Ñ–∞–ª—à–∏–≤–∞—Ç–∞ —Ç–µ—Å—Ç–æ–≤–∞ ‚Äî –≤—ä—Ä–Ω–∏ –∫—ä–º landing
      if (!sess || !user || user.email === 'test@example.bg' || user.id === 'user_001') {
        localStorage.clear();
        window.location.replace('imotiq-landing.html');
      }
    })();
</script>
<div class="cursor" id="cursor"></div>
<div class="cursor-ring" id="cursorRing"></div>

<!-- SIDEBAR -->
<aside class="sidebar">
  <div class="sidebar-logo">Imot<span>IQ</span></div>
  <div style="padding:12px 8px 0;">
    <div class="sidebar-section">–ì–ª–∞–≤–Ω–æ</div>
    <a class="nav-item" href="imotiq-dashboard.html"><span class="nav-icon">‚ö°</span> Dashboard</a>
    <a class="nav-item" href="imotiq-dashboard.html"><span class="nav-icon">üß†</span> AI –ê–Ω–∞–ª–∏–∑</a>
    <a class="nav-item" href="imotiq-alerts.html"><span class="nav-icon">üîî</span> –ú–æ–∏—Ç–µ Alerts<span class="nav-badge">3</span></a>

    <div class="sidebar-section">–ü–∞–∑–∞—Ä</div>
    <a class="nav-item active" href="imotiq-tracker.html"><span class="nav-icon">üìä</span> –ö–≤–∞—Ä—Ç–∞–ª–µ–Ω –¢—Ä–µ–∫–µ—Ä</a>
    <a class="nav-item" href="imotiq-trend.html"><span class="nav-icon">üìà</span> –¶–µ–Ω–æ–≤–∏ –¢—Ä–µ–Ω–¥</a>
    <a class="nav-item" href="imotiq-report.html"><span class="nav-icon">üèòÔ∏è</span> –ö–≤–∞—Ä—Ç–∞–ª–µ–Ω –î–æ–∫–ª–∞–¥</a>

    <div class="sidebar-section">–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏</div>
    <a class="nav-item" href="imotiq-calculator.html"><span class="nav-icon">‚öñÔ∏è</span> –ù–∞–µ–º vs –ö—É–ø—É–≤–∞–Ω–µ</a>
    <a class="nav-item" href="imotiq-detector.html"><span class="nav-icon">üîç</span> –§–∞–ª—à–∏–≤–∏ –û–±—è–≤–∏</a>
    <a class="nav-item" href="imotiq-history.html"><span class="nav-icon">üìã</span> –ò—Å—Ç–æ—Ä–∏—è</a>

    <div class="sidebar-section">–ê–∫–∞—É–Ω—Ç</div>
    <a class="nav-item" href="imotiq-settings.html"><span class="nav-icon">‚öôÔ∏è</span> –ù–∞—Å—Ç—Ä–æ–π–∫–∏</a>
  </div>
  <div class="sidebar-bottom">
    <div class="plan-widget">
      <div class="plan-name">üÜì –ë–µ–∑–ø–ª–∞—Ç–µ–Ω –ø–ª–∞–Ω</div>
      <div class="plan-usage">1 –æ—Ç 1 –∞–Ω–∞–ª–∏–∑–∞ –∏–∑–ø–æ–ª–∑–≤–∞–Ω</div>
      <div class="usage-bar"><div class="usage-fill" style="width:100%"></div></div>
      <a href="#" class="upgrade-btn">–ù–∞–¥–≥—Ä–∞–¥–∏ –∫—ä–º –°—Ç–∞–Ω–¥–∞—Ä—Ç ‚Üí</a>
    </div>
    <div class="user-row">
      <div class="avatar">–ò–ò</div>
      <div><div class="user-name">–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤</div><div class="user-plan">–ë–µ–∑–ø–ª–∞—Ç–µ–Ω –ø–ª–∞–Ω</div></div>
      <button class="logout-btn" onclick="logout()">‚èª</button>
    </div>
  </div>
</aside>

<!-- MAIN -->
<main class="main">
  <div class="topbar">
    <div class="page-title">üìä –ö–≤–∞—Ä—Ç–∞–ª–µ–Ω –¢—Ä–µ–∫–µ—Ä</div>
    <div class="topbar-right">
      <div style="font-size:0.78rem;color:var(--cream-dim)" id="currentDate"></div>
      <div class="notif-btn">üîî<div class="notif-dot"></div></div>
    </div>
  </div>

  <div class="content">

    <!-- FILTER BAR -->
    <div class="filter-bar">
      <span class="filter-label">–¢–∏–ø –∏–º–æ—Ç:</span>
      <button class="filter-btn active" onclick="setFilter(this,'type')">–í—Å–∏—á–∫–∏</button>
      <button class="filter-btn" onclick="setFilter(this,'type')">–ê–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–∏</button>
      <button class="filter-btn" onclick="setFilter(this,'type')">–ö—ä—â–∏</button>
      <button class="filter-btn" onclick="setFilter(this,'type')">–°—Ç—É–¥–∏—è</button>
      <div class="filter-sep"></div>
      <span class="filter-label">–ü–µ—Ä–∏–æ–¥:</span>
      <button class="filter-btn active" onclick="setFilter(this,'period')">12 –º–µ—Å–µ—Ü–∞</button>
      <button class="filter-btn" onclick="setFilter(this,'period')">6 –º–µ—Å–µ—Ü–∞</button>
      <button class="filter-btn" onclick="setFilter(this,'period')">3 –º–µ—Å–µ—Ü–∞</button>
    </div>

    <!-- CHIPS -->
    <div class="chips-wrap" id="chipsWrap"></div>

    <!-- MAIN CHART -->
    <div class="chart-card fade-in">
      <div class="chart-header">
        <div>
          <div class="chart-title">–°—Ä–µ–¥–µ–Ω –ª–≤/–º¬≤ –ø–æ –∫–≤–∞—Ä—Ç–∞–ª–∏ ‚Äî –ø–æ—Å–ª–µ–¥–Ω–∏—Ç–µ 12 –º–µ—Å–µ—Ü–∞</div>
          <div class="chart-sub" id="chartSub">–ò–∑–±–µ—Ä–∏ –∫–≤–∞—Ä—Ç–∞–ª–∏ –æ—Ç –≥–æ—Ä–µ –∑–∞ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ</div>
        </div>
        <div class="chart-legend" id="chartLegend"></div>
      </div>
      <canvas id="mainChart" height="90"></canvas>
    </div>

    <!-- DISTRICT CARDS -->
    <div class="district-grid">
      <div class="district-card selected fade-in" style="--dcolor:#C9A84C" onclick="selectDistrict(this,'–õ–æ–∑–µ–Ω–µ—Ü')">
        <div class="d-name">üèôÔ∏è –õ–æ–∑–µ–Ω–µ—Ü</div>
        <div class="d-price">3,240</div>
        <div class="d-unit">–ª–≤ / –º¬≤</div>
        <span class="d-trend up">‚Üë +4.2%</span>
        <canvas class="d-mini-chart" id="mini0"></canvas>
      </div>
      <div class="district-card fade-in" style="--dcolor:#4C7AC9" onclick="selectDistrict(this,'–ú–ª–∞–¥–æ—Å—Ç')">
        <div class="d-name">üè¢ –ú–ª–∞–¥–æ—Å—Ç</div>
        <div class="d-price">2,180</div>
        <div class="d-unit">–ª–≤ / –º¬≤</div>
        <span class="d-trend up">‚Üë +2.8%</span>
        <canvas class="d-mini-chart" id="mini1"></canvas>
      </div>
      <div class="district-card fade-in" style="--dcolor:#2ECC8A" onclick="selectDistrict(this,'–í–∏—Ç–æ—à–∞')">
        <div class="d-name">üåø –í–∏—Ç–æ—à–∞</div>
        <div class="d-price">2,640</div>
        <div class="d-unit">–ª–≤ / –º¬≤</div>
        <span class="d-trend up">‚Üë +1.9%</span>
        <canvas class="d-mini-chart" id="mini2"></canvas>
      </div>
      <div class="district-card fade-in" style="--dcolor:#E84C4C" onclick="selectDistrict(this,'–°—Ç—É–¥–µ–Ω—Ç—Å–∫–∏')">
        <div class="d-name">üéì –°—Ç—É–¥–µ–Ω—Ç—Å–∫–∏</div>
        <div class="d-price">1,820</div>
        <div class="d-unit">–ª–≤ / –º¬≤</div>
        <span class="d-trend down">‚Üì -0.5%</span>
        <canvas class="d-mini-chart" id="mini3"></canvas>
      </div>
      <div class="district-card fade-in" style="--dcolor:#9B59B6" onclick="selectDistrict(this,'–ù–∞–¥–µ–∂–¥–∞')">
        <div class="d-name">üèòÔ∏è –ù–∞–¥–µ–∂–¥–∞</div>
        <div class="d-price">1,560</div>
        <div class="d-unit">–ª–≤ / –º¬≤</div>
        <span class="d-trend flat">‚Üí +0.2%</span>
        <canvas class="d-mini-chart" id="mini4"></canvas>
      </div>
      <div class="district-card fade-in" style="--dcolor:#F39C12" onclick="selectDistrict(this,'–õ—é–ª–∏–Ω')">
        <div class="d-name">üèóÔ∏è –õ—é–ª–∏–Ω</div>
        <div class="d-price">1,340</div>
        <div class="d-unit">–ª–≤ / –º¬≤</div>
        <span class="d-trend up">‚Üë +3.1%</span>
        <canvas class="d-mini-chart" id="mini5"></canvas>
      </div>
    </div>

    <!-- BOTTOM ROW -->
    <div class="bottom-row">
      <!-- TOP –ø–æ —Ü–µ–Ω–∞ -->
      <div class="panel fade-in">
        <div class="panel-header">
          <div class="panel-title">üèÜ –¢–æ–ø –∫–≤–∞—Ä—Ç–∞–ª–∏ –ø–æ —Ä—ä—Å—Ç –Ω–∞ —Ü–µ–Ω–∏—Ç–µ</div>
          <a href="#" class="panel-action">–ü—ä–ª–Ω–∞ –ª–∏—Å—Ç–∞</a>
        </div>
        <div class="top-item">
          <div class="top-rank">1</div>
          <div class="top-info"><div class="top-name">–õ–æ–∑–µ–Ω–µ—Ü</div><div class="top-sub">–¶–µ–Ω—Ç—Ä–∞–ª–µ–Ω, –≤–∏—Å–æ–∫ –∫–ª–∞—Å</div></div>
          <div><div class="top-price">3,240 –ª–≤/–º¬≤</div><div class="top-change up">‚Üë +4.2%</div></div>
        </div>
        <div class="top-item">
          <div class="top-rank">2</div>
          <div class="top-info"><div class="top-name">–õ—é–ª–∏–Ω</div><div class="top-sub">–ó–∞–ø–∞–¥–Ω–∞ Sofia, —Ä–∞—Å—Ç—è—â</div></div>
          <div><div class="top-price">1,340 –ª–≤/–º¬≤</div><div class="top-change up">‚Üë +3.1%</div></div>
        </div>
        <div class="top-item">
          <div class="top-rank">3</div>
          <div class="top-info"><div class="top-name">–ú–ª–∞–¥–æ—Å—Ç</div><div class="top-sub">–ë–∏–∑–Ω–µ—Å –∑–æ–Ω–∞, —Ç—ä—Ä—Å–µ–Ω</div></div>
          <div><div class="top-price">2,180 –ª–≤/–º¬≤</div><div class="top-change up">‚Üë +2.8%</div></div>
        </div>
        <div class="top-item">
          <div class="top-rank">4</div>
          <div class="top-info"><div class="top-name">–í–∏—Ç–æ—à–∞</div><div class="top-sub">–Æ–∂–µ–Ω, –∑–µ–ª–µ–Ω–∞ —Å—Ä–µ–¥–∞</div></div>
          <div><div class="top-price">2,640 –ª–≤/–º¬≤</div><div class="top-change up">‚Üë +1.9%</div></div>
        </div>
        <div class="top-item">
          <div class="top-rank">5</div>
          <div class="top-info"><div class="top-name">–ù–∞–¥–µ–∂–¥–∞</div><div class="top-sub">–°–µ–≤–µ—Ä–µ–Ω, –¥–æ—Å—Ç—ä–ø–µ–Ω</div></div>
          <div><div class="top-price">1,560 –ª–≤/–º¬≤</div><div class="top-change flat">‚Üí +0.2%</div></div>
        </div>
        <div class="top-item">
          <div class="top-rank">6</div>
          <div class="top-info"><div class="top-name">–°—Ç—É–¥–µ–Ω—Ç—Å–∫–∏</div><div class="top-sub">–ù–∞–µ–º–µ–Ω –ø–∞–∑–∞—Ä</div></div>
          <div><div class="top-price">1,820 –ª–≤/–º¬≤</div><div class="top-change down">‚Üì -0.5%</div></div>
        </div>
      </div>

      <!-- HEATMAP -->
      <div class="panel fade-in">
        <div class="panel-header">
          <div class="panel-title">üó∫Ô∏è –¶–µ–Ω–æ–≤–∞ —Ç–æ–ø–ª–∏–Ω–Ω–∞ –∫–∞—Ä—Ç–∞</div>
          <span style="font-size:0.72rem;color:var(--cream-dim)">–ª–≤/–º¬≤</span>
        </div>
        <div class="heatmap-grid" id="heatmap"></div>
        <div style="padding:12px 20px;display:flex;gap:16px;align-items:center;border-top:1px solid rgba(255,255,255,0.04)">
          <span style="font-size:0.68rem;color:var(--cream-dim)">–ü–æ-–Ω–∏—Å–∫–∞ —Ü–µ–Ω–∞</span>
          <div style="flex:1;height:6px;border-radius:3px;background:linear-gradient(90deg,#1a3a2a,#2ECC8A,#C9A84C,#E84C4C)"></div>
          <span style="font-size:0.68rem;color:var(--cream-dim)">–ü–æ-–≤–∏—Å–æ–∫–∞ —Ü–µ–Ω–∞</span>
        </div>
      </div>
    </div>

  </div>
</main>

<script>
  // Date
  
  // –ü–æ–∫–∞–∂–∏ —Ä–µ–∞–ª–Ω–æ—Ç–æ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—Å–∫–æ –∏–º–µ
  (function() {
    var u = JSON.parse(localStorage.getItem('imotiq_user') || 'null');
    if (!u || !u.name) return;
    document.querySelectorAll('.user-name').forEach(function(el) { el.textContent = u.name; });
    document.querySelectorAll('.avatar').forEach(function(el) {
      if (u.avatar) {
        el.innerHTML = '<img src="' + u.avatar + '" style="width:100%;height:100%;border-radius:50%;object-fit:cover">';
      } else {
        el.textContent = u.name.charAt(0).toUpperCase();
      }
    });
    document.querySelectorAll('.user-plan').forEach(function(el) {
      var plans = {free:'–ë–µ–∑–ø–ª–∞—Ç–µ–Ω –ø–ª–∞–Ω', standard:'–°—Ç–∞–Ω–¥–∞—Ä—Ç', pro:'–ü—Ä–æ', broker:'–ë—Ä–æ–∫–µ—Ä'};
      el.textContent = plans[u.plan] || '–ë–µ–∑–ø–ª–∞—Ç–µ–Ω –ø–ª–∞–Ω';
    });
  })();

  document.getElementById('currentDate').textContent = new Date().toLocaleDateString('bg-BG',{weekday:'long',day:'numeric',month:'long'});

  const months = ['–§–µ–≤','–ú–∞—Ä','–ê–ø—Ä','–ú–∞–π','–Æ–Ω–∏','–Æ–ª–∏','–ê–≤–≥','–°–µ–ø','–û–∫—Ç','–ù–æ–µ','–î–µ–∫','–Ø–Ω—É'];

  // ALL DISTRICTS DATA
  const allDistricts = [
    { name:'–õ–æ–∑–µ–Ω–µ—Ü',       emoji:'üèôÔ∏è', color:'#C9A84C', price:3240, trend:'+4.2%', dir:'up',   data:[2840,2890,2950,2980,3020,3060,3090,3110,3140,3180,3210,3240] },
    { name:'–ò–≤–∞–Ω –í–∞–∑–æ–≤',    emoji:'üèõÔ∏è', color:'#E67E22', price:2980, trend:'+3.5%', dir:'up',   data:[2600,2640,2680,2710,2750,2790,2820,2850,2880,2910,2945,2980] },
    { name:'–í–∏—Ç–æ—à–∞',        emoji:'üåø', color:'#2ECC8A', price:2640, trend:'+1.9%', dir:'up',   data:[2480,2490,2510,2530,2550,2570,2580,2600,2615,2625,2635,2640] },
    { name:'–°–∏–º–µ–æ–Ω–æ–≤–æ',     emoji:'üå≤', color:'#27AE60', price:3100, trend:'+5.1%', dir:'up',   data:[2700,2740,2780,2820,2870,2910,2940,2980,3010,3050,3075,3100] },
    { name:'–ë–æ—è–Ω–∞',         emoji:'üè°', color:'#16A085', price:2850, trend:'+2.3%', dir:'up',   data:[2620,2650,2680,2710,2740,2770,2790,2810,2820,2830,2842,2850] },
    { name:'–ú–ª–∞–¥–æ—Å—Ç 1',     emoji:'üè¢', color:'#4C7AC9', price:2180, trend:'+2.8%', dir:'up',   data:[1980,2000,2020,2040,2060,2080,2090,2110,2130,2150,2165,2180] },
    { name:'–ú–ª–∞–¥–æ—Å—Ç 4',     emoji:'üèóÔ∏è', color:'#2980B9', price:2050, trend:'+2.1%', dir:'up',   data:[1880,1900,1920,1940,1960,1975,1990,2005,2020,2030,2042,2050] },
    { name:'–°—Ç—É–¥–µ–Ω—Ç—Å–∫–∏',    emoji:'üéì', color:'#E84C4C', price:1820, trend:'-0.5%', dir:'down', data:[1850,1848,1845,1840,1838,1835,1832,1828,1825,1822,1820,1820] },
    { name:'–î—Ä—É–∂–±–∞',        emoji:'üèòÔ∏è', color:'#C0392B', price:1750, trend:'+0.8%', dir:'up',   data:[1680,1690,1700,1710,1718,1725,1730,1736,1740,1744,1748,1750] },
    { name:'–ù–∞–¥–µ–∂–¥–∞',       emoji:'üèòÔ∏è', color:'#9B59B6', price:1560, trend:'+0.2%', dir:'flat', data:[1510,1515,1520,1525,1530,1535,1540,1545,1548,1552,1556,1560] },
    { name:'–ö—Ä–∞—Å–Ω–∞ –ø–æ–ª—è–Ω–∞', emoji:'üåÜ', color:'#8E44AD', price:1680, trend:'+1.4%', dir:'up',   data:[1580,1590,1600,1610,1620,1630,1638,1648,1658,1665,1673,1680] },
    { name:'–õ—é–ª–∏–Ω',         emoji:'üèóÔ∏è', color:'#F39C12', price:1340, trend:'+3.1%', dir:'up',   data:[1180,1200,1220,1245,1265,1285,1295,1305,1315,1325,1333,1340] },
    { name:'–û–±–µ–ª—è',         emoji:'üèöÔ∏è', color:'#D68910', price:1280, trend:'+1.8%', dir:'up',   data:[1200,1210,1220,1228,1235,1242,1250,1258,1264,1270,1275,1280] },
    { name:'–•–∏–ø–æ–¥—Ä—É–º–∞',     emoji:'üêé', color:'#BA4A00', price:2350, trend:'+3.8%', dir:'up',   data:[2080,2110,2150,2185,2210,2240,2265,2285,2305,2325,2340,2350] },
    { name:'–ë–æ—Ä–æ–≤–æ',        emoji:'üå≥', color:'#1ABC9C', price:2420, trend:'+2.5%', dir:'up',   data:[2240,2265,2285,2310,2335,2355,2370,2385,2395,2405,2413,2420] },
    { name:'–ë–∞–Ω–∏—à–æ—Ä–∞',      emoji:'üèôÔ∏è', color:'#48C9B0', price:1420, trend:'+1.2%', dir:'up',   data:[1340,1350,1360,1370,1378,1386,1394,1400,1407,1412,1417,1420] },
    { name:'–ó–∞—Ö–∞—Ä–Ω–∞ —Ñ–∞–±—Ä–∏–∫–∞',emoji:'üè≠',color:'#76D7C4', price:1490, trend:'+0.9%', dir:'up',   data:[1410,1420,1428,1436,1444,1452,1458,1465,1470,1477,1484,1490] },
    { name:'–ì–æ—Ä–Ω–∞ –±–∞–Ω—è',    emoji:'üíß', color:'#5DADE2', price:2400, trend:'+4.5%', dir:'up',   data:[2080,2120,2160,2200,2240,2275,2305,2330,2350,2370,2388,2400] },
    { name:'–î—Ä–∞–≥–∞–ª–µ–≤—Ü–∏',    emoji:'üèîÔ∏è', color:'#3498DB', price:2700, trend:'+3.9%', dir:'up',   data:[2360,2400,2440,2480,2520,2560,2590,2620,2645,2665,2684,2700] },
    { name:'–ë—ä–∫—Å—Ç–æ–Ω',       emoji:'üè†', color:'#85C1E9', price:1920, trend:'+1.6%', dir:'up',   data:[1800,1815,1830,1845,1858,1870,1880,1890,1898,1906,1914,1920] },
  ];

  // Active districts (initially top 5)
  let activeNames = new Set(['–õ–æ–∑–µ–Ω–µ—Ü','–ú–ª–∞–¥–æ—Å—Ç 1','–í–∏—Ç–æ—à–∞','–°—Ç—É–¥–µ–Ω—Ç—Å–∫–∏','–ù–∞–¥–µ–∂–¥–∞']);

  // Build chips
  const chipsWrap = document.getElementById('chipsWrap');
  allDistricts.forEach(d => {
    const chip = document.createElement('button');
    chip.className = 'chip' + (activeNames.has(d.name) ? ' active' : '');
    chip.style.background = activeNames.has(d.name) ? d.color : '';
    chip.innerHTML = `<span class="chip-dot" style="background:${d.color}"></span>${d.emoji} ${d.name}`;
    chip.dataset.name = d.name;
    chip.addEventListener('click', () => toggleDistrict(d.name, chip, d.color));
    chipsWrap.appendChild(chip);
  });

  // MAIN CHART
  const ctx = document.getElementById('mainChart').getContext('2d');
  const mainChart = new Chart(ctx, {
    type: 'line',
    data: { labels: months, datasets: [] },
    options: {
      responsive:true, interaction:{mode:'index',intersect:false},
      plugins:{ legend:{display:false}, tooltip:{
        backgroundColor:'rgba(17,17,24,0.95)', borderColor:'rgba(201,168,76,0.2)', borderWidth:1,
        titleColor:'#F5F0E8', bodyColor:'#D4CCB8', padding:12,
        callbacks:{ label: c => ` ${c.dataset.label}: ${c.parsed.y.toLocaleString()} –ª–≤/–º¬≤` }
      }},
      scales:{
        x:{ grid:{color:'rgba(255,255,255,0.04)'}, ticks:{color:'rgba(212,204,184,0.5)',font:{size:11,family:'DM Sans'}} },
        y:{ grid:{color:'rgba(255,255,255,0.04)'}, ticks:{color:'rgba(212,204,184,0.5)',font:{size:11,family:'DM Sans'},callback:v=>v.toLocaleString()+' –ª–≤'}, min:1000 }
      },
      animation:{ duration:400 }
    }
  });

  function updateChart() {
    const active = allDistricts.filter(d => activeNames.has(d.name));
    mainChart.data.datasets = active.map(d => ({
      label: d.name,
      data: d.data,
      borderColor: d.color,
      backgroundColor: d.color + '12',
      tension: 0.4, pointRadius: 3, pointHoverRadius: 6, borderWidth: 2
    }));
    mainChart.update();

    // Update legend
    const legend = document.getElementById('chartLegend');
    legend.innerHTML = active.map(d => `<div class="legend-item"><div class="legend-dot" style="background:${d.color}"></div>${d.name}</div>`).join('');

    // Update sub
    document.getElementById('chartSub').textContent = active.length === 0
      ? '–ò–∑–±–µ—Ä–∏ –∫–≤–∞—Ä—Ç–∞–ª–∏ –æ—Ç –≥–æ—Ä–µ –∑–∞ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ'
      : `–°—Ä–∞–≤–Ω—è–≤–∞—à ${active.length} –∫–≤–∞—Ä—Ç–∞–ª–∞ –µ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ`;
  }

  function toggleDistrict(name, chip, color) {
    if (activeNames.has(name)) {
      if (activeNames.size === 1) return; // keep at least 1
      activeNames.delete(name);
      chip.classList.remove('active');
      chip.style.background = '';
    } else {
      activeNames.add(name);
      chip.classList.add('active');
      chip.style.background = color;
    }
    updateChart();
  }

  updateChart(); // initial render

  // MINI CHARTS
  const miniData = [
    [2840,2890,2950,3020,3090,3140,3180,3240],
    [1980,2000,2040,2060,2090,2130,2165,2180],
    [2480,2510,2550,2580,2600,2615,2635,2640],
    [1850,1845,1838,1832,1828,1825,1821,1820],
    [1510,1520,1530,1540,1548,1552,1556,1560],
    [1180,1200,1220,1250,1280,1300,1320,1340],
  ];
  const miniColors = ['#C9A84C','#4C7AC9','#2ECC8A','#E84C4C','#9B59B6','#F39C12'];

  miniData.forEach((data,i) => {
    const c = document.getElementById('mini'+i).getContext('2d');
    new Chart(c,{
      type:'line',
      data:{ labels:Array(8).fill(''), datasets:[{ data, borderColor:miniColors[i], borderWidth:2, tension:0.4, pointRadius:0, fill:true, backgroundColor: c => { const g=c.chart.ctx.createLinearGradient(0,0,0,36); g.addColorStop(0,miniColors[i].replace('#','rgba(').replace(/(..)(..)(..)/, (_,r,g2,b)=>`${parseInt(r,16)},${parseInt(g2,16)},${parseInt(b,16)}`)+',0.15)'); g.addColorStop(1,'transparent'); return g; } }] },
      options:{ responsive:true, plugins:{legend:{display:false},tooltip:{enabled:false}}, scales:{x:{display:false},y:{display:false}} }
    });
  });

  // HEATMAP
  const heatDistricts = ['–õ–æ–∑–µ–Ω–µ—Ü','–ò–≤–∞–Ω –í–∞–∑–æ–≤','–í–∏—Ç–æ—à–∞','–ë–æ—Ä–æ–≤–æ','–î—Ä—É–∂–±–∞','–ú–æ–¥–µ—Ä–Ω–æ',
    '–ú–ª–∞–¥–æ—Å—Ç 1','–ú–ª–∞–¥–æ—Å—Ç 2','–°—Ç—É–¥–µ–Ω—Ç—Å–∫–∏','–ö—Ä–∞—Å–Ω–æ','–ù–∞–¥–µ–∂–¥–∞','–•–∏–ø–æ–¥—Ä—É–º–∞',
    '–õ—é–ª–∏–Ω','–û–±–µ–ª—è','–¢—Ä–µ–±–∏—á','–ë–∞–Ω–∏—à–æ—Ä–∞','–û—Ä–ª–∞–Ω–¥–æ–≤—Ü–∏','–ö—Ä–∞—Å–Ω–∞ –ø–æ–ª—è–Ω–∞',
    '–ó–∞—Ö–∞—Ä–Ω–∞ —Ñ–∞–±—Ä–∏–∫–∞','–í–æ–ª—É—è–∫','–ë–æ—è–Ω–∞','–°–∏–º–µ–æ–Ω–æ–≤–æ','–î—Ä–∞–≥–∞–ª–µ–≤—Ü–∏','–ì–æ—Ä–Ω–∞ –±–∞–Ω—è'];
  const heatPrices = [3240,2980,2640,2420,2180,2050,2180,2100,1820,2200,1560,2350,1340,1280,1380,1420,1250,1680,1490,1200,2850,3100,2700,2400];

  const max=Math.max(...heatPrices), min=Math.min(...heatPrices);
  const heatmap = document.getElementById('heatmap');
  heatPrices.forEach((p,i)=>{
    const ratio=(p-min)/(max-min);
    const r=Math.round(26+ratio*(232-26));
    const g=Math.round(58+ratio*(76-204)+204*(1-ratio));
    const b=Math.round(42+ratio*(76-138));
    const cell=document.createElement('div');
    cell.className='heat-cell';
    cell.style.background=`rgb(${r},${Math.max(10,204-ratio*160)},${Math.max(10,138-ratio*96)})`;
    cell.style.opacity=0.7+ratio*0.3;
    cell.title=`${heatDistricts[i]}: ${p.toLocaleString()} –ª–≤/–º¬≤`;
    cell.textContent=heatDistricts[i].substring(0,3);
    heatmap.appendChild(cell);
  });

  // FILTERS
  function setFilter(btn, group) {
    btn.closest('.filter-bar').querySelectorAll('.filter-btn').forEach(b=>{
      if(b.closest('.filter-bar')===btn.closest('.filter-bar')) {
        const sameGroup = (group==='type' ? b.dataset.group!=='period' : b.dataset.group==='period');
      }
    });
    // Simple: toggle active within siblings of same type
    const allBtns = btn.parentElement.querySelectorAll ? [...btn.parentElement.children].filter(el=>el.classList.contains('filter-btn')) : [];
    // Better approach: mark buttons
    btn.parentElement.querySelectorAll && btn.parentElement.querySelectorAll('.filter-btn');
    // Just toggle this button active among its "group"
    const bar = btn.closest('.filter-bar');
    const sepIdx = [...bar.children].indexOf(btn.closest('.filter-sep') || btn);
    bar.querySelectorAll('.filter-btn').forEach(b => {
      if(b === btn) b.classList.add('active');
    });
    // Keep it simple - each click activates clicked button
    btn.classList.add('active');
  }

  function selectDistrict(card) {
    document.querySelectorAll('.district-card').forEach(c=>c.classList.remove('selected'));
    card.classList.add('selected');
  }

  // CURSOR
  const cursor=document.getElementById('cursor'), ring=document.getElementById('cursorRing');
  let mx=0,my=0,rx=0,ry=0;
  document.addEventListener('mousemove',e=>{ mx=e.clientX; my=e.clientY; cursor.style.left=mx-5+'px'; cursor.style.top=my-5+'px'; });
  function animRing(){ rx+=(mx-rx-16)*0.12; ry+=(my-ry-16)*0.12; ring.style.left=rx+'px'; ring.style.top=ry+'px'; requestAnimationFrame(animRing); }
  animRing();
  document.querySelectorAll('a,button,input').forEach(el=>{ el.addEventListener('mouseenter',()=>cursor.style.transform='scale(2.5)'); el.addEventListener('mouseleave',()=>cursor.style.transform='scale(1)'); });

  // MOBILE SIDEBAR
  function toggleSidebar(){
    document.querySelector('.sidebar').classList.toggle('open');
    document.getElementById('burgerBtn').classList.toggle('open');
    document.getElementById('mobileOverlay').classList.toggle('show');
  }
  function closeSidebar(){
    document.querySelector('.sidebar').classList.remove('open');
    document.getElementById('burgerBtn').classList.remove('open');
    document.getElementById('mobileOverlay').classList.remove('show');
  }
  // Close sidebar on nav click (mobile)
  document.querySelectorAll('.nav-item').forEach(a => a.addEventListener('click', closeSidebar));

</script>
</body>
</html>
