<!DOCTYPE html>
<html lang="bg">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ImotIQ â€” ĞœĞ¾Ğ¸Ñ‚Ğµ Alerts</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=DM+Sans:wght@300;400;500&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --gold:#C9A84C; --gold-light:#E8C97A; --gold-dim:rgba(201,168,76,0.12);
    --dark:#0A0A0F; --dark-2:#111118; --dark-3:#1A1A24;
    --cream:#F5F0E8; --cream-dim:#D4CCB8;
    --green:#2ECC8A; --green-dim:rgba(46,204,138,0.12);
    --red:#E84C4C; --red-dim:rgba(232,76,76,0.12);
    --blue:#4C7AC9; --blue-dim:rgba(76,122,201,0.12);
    --orange:#F39C12; --orange-dim:rgba(243,156,18,0.12);
    --sidebar:260px;
  }
  *{margin:0;padding:0;box-sizing:border-box;}
  body{background:var(--dark);color:var(--cream);font-family:'DM Sans',sans-serif;display:flex;min-height:100vh;cursor:auto;}
  .cursor{width:10px;height:10px;background:var(--gold);border-radius:50%;position:fixed;pointer-events:none;z-index:9999;transition:transform 0.15s;mix-blend-mode:difference;}
  .cursor-ring{width:32px;height:32px;border:1px solid rgba(201,168,76,0.5);border-radius:50%;position:fixed;pointer-events:none;z-index:9998;transition:all 0.08s;}

  /* SIDEBAR */
  .sidebar{width:var(--sidebar);min-height:100vh;background:var(--dark-2);border-right:1px solid rgba(255,255,255,0.05);display:flex;flex-direction:column;position:fixed;top:0;left:0;bottom:0;z-index:50;}
  .sidebar-logo{padding:28px 24px 24px;border-bottom:1px solid rgba(255,255,255,0.05);font-family:'Syne',sans-serif;font-weight:800;font-size:1.4rem;}
  .sidebar-logo span{color:var(--gold);}
  .sidebar-section{padding:20px 16px 8px;font-size:0.62rem;text-transform:uppercase;letter-spacing:0.14em;color:rgba(212,204,184,0.3);}
  .nav-item{display:flex;align-items:center;gap:12px;padding:10px 16px;margin:2px 8px;border-radius:8px;cursor:auto;transition:all 0.2s;color:var(--cream-dim);font-size:0.88rem;text-decoration:none;position:relative;}
  .nav-item:hover{background:rgba(255,255,255,0.04);color:var(--cream);}
  .nav-item.active{background:var(--gold-dim);color:var(--gold);}
  .nav-item.active::before{content:'';position:absolute;left:-8px;top:50%;transform:translateY(-50%);width:3px;height:60%;background:var(--gold);border-radius:0 3px 3px 0;}
  .nav-icon{width:18px;font-size:1rem;text-align:center;}
  .nav-badge{margin-left:auto;background:var(--gold);color:var(--dark);font-size:0.6rem;font-weight:700;padding:2px 7px;border-radius:100px;font-family:'Syne',sans-serif;}
  .sidebar-bottom{margin-top:auto;padding:16px;border-top:1px solid rgba(255,255,255,0.05);}
  .plan-widget{background:var(--gold-dim);border:1px solid rgba(201,168,76,0.2);border-radius:10px;padding:14px;margin-bottom:12px;}
  .plan-name{font-family:'Syne',sans-serif;font-weight:700;font-size:0.75rem;color:var(--gold);margin-bottom:4px;}
  .plan-usage{font-size:0.72rem;color:var(--cream-dim);margin-bottom:8px;}
  .usage-bar{height:3px;background:rgba(255,255,255,0.08);border-radius:3px;overflow:hidden;}
  .usage-fill{height:100%;background:var(--gold);border-radius:3px;}
  .upgrade-btn{display:block;text-align:center;padding:8px;background:var(--gold);color:var(--dark);border-radius:6px;font-family:'Syne',sans-serif;font-weight:700;font-size:0.72rem;text-decoration:none;margin-top:10px;cursor:auto;transition:background 0.2s;}
  .upgrade-btn:hover{background:var(--gold-light);}
  .user-row{display:flex;align-items:center;gap:10px;}
  .avatar{width:34px;height:34px;background:linear-gradient(135deg,var(--gold),#8B6A1F);border-radius:50%;display:flex;align-items:center;justify-content:center;font-family:'Syne',sans-serif;font-weight:700;font-size:0.8rem;color:var(--dark);flex-shrink:0;}
  .user-name{font-size:0.82rem;font-weight:500;}
  .user-plan{font-size:0.7rem;color:var(--cream-dim);}
  .logout-btn{margin-left:auto;background:none;border:none;color:rgba(212,204,184,0.3);cursor:auto;font-size:0.8rem;transition:color 0.2s;}
  .logout-btn:hover{color:var(--red);}

  /* MAIN */
  .main{margin-left:var(--sidebar);flex:1;display:flex;flex-direction:column;}
  .topbar{padding:20px 36px;border-bottom:1px solid rgba(255,255,255,0.05);display:flex;align-items:center;justify-content:space-between;background:var(--dark);position:sticky;top:0;z-index:40;}
  .page-title{font-family:'Syne',sans-serif;font-weight:700;font-size:1.1rem;}
  .notif-btn{width:36px;height:36px;background:var(--dark-3);border:1px solid rgba(255,255,255,0.06);border-radius:8px;display:flex;align-items:center;justify-content:center;cursor:auto;font-size:1rem;position:relative;}
  .notif-dot{position:absolute;top:6px;right:6px;width:7px;height:7px;background:var(--gold);border-radius:50%;border:1.5px solid var(--dark);}
  .content{padding:32px 36px;flex:1;}

  /* STATS ROW */
  .stats-row{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-bottom:24px;}
  .stat-box{background:var(--dark-3);border:1px solid rgba(255,255,255,0.05);border-radius:12px;padding:18px 20px;}
  .sb-label{font-size:0.65rem;text-transform:uppercase;letter-spacing:0.1em;color:rgba(212,204,184,0.4);margin-bottom:8px;}
  .sb-val{font-family:'Syne',sans-serif;font-weight:800;font-size:1.6rem;line-height:1;}
  .sb-sub{font-size:0.72rem;color:var(--cream-dim);margin-top:4px;}

  /* NEW ALERT CARD */
  .new-alert-card{background:var(--dark-3);border:1px solid rgba(201,168,76,0.15);border-radius:16px;padding:28px;margin-bottom:24px;position:relative;overflow:hidden;}
  .new-alert-card::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,var(--gold),transparent);}
  .nac-title{font-family:'Syne',sans-serif;font-weight:700;font-size:1rem;margin-bottom:20px;display:flex;align-items:center;gap:8px;}

  .alert-form{display:grid;grid-template-columns:1fr 1fr 1fr auto;gap:12px;align-items:end;}
  .form-field{display:flex;flex-direction:column;gap:6px;}
  .form-label{font-size:0.68rem;text-transform:uppercase;letter-spacing:0.1em;color:var(--cream-dim);}
  .form-input{background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.08);border-radius:8px;padding:10px 14px;color:var(--cream);font-family:'DM Sans',sans-serif;font-size:0.84rem;outline:none;transition:border-color 0.2s;}
  .form-input:focus{border-color:rgba(201,168,76,0.4);}
  .form-select{background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.08);border-radius:8px;padding:10px 14px;color:var(--cream);font-family:'DM Sans',sans-serif;font-size:0.84rem;outline:none;cursor:auto;}
  .add-btn{background:var(--gold);color:var(--dark);border:none;padding:10px 24px;border-radius:8px;font-family:'Syne',sans-serif;font-weight:700;font-size:0.85rem;cursor:auto;transition:all 0.2s;white-space:nowrap;height:42px;}
  .add-btn:hover{background:var(--gold-light);}

  /* TABS */
  .tabs{display:flex;gap:4px;margin-bottom:16px;background:rgba(255,255,255,0.03);border-radius:8px;padding:4px;width:fit-content;}
  .tab{padding:8px 18px;border-radius:6px;border:none;background:none;color:var(--cream-dim);font-size:0.82rem;cursor:auto;transition:all 0.2s;font-family:'DM Sans',sans-serif;}
  .tab.active{background:var(--gold-dim);color:var(--gold);border:1px solid rgba(201,168,76,0.25);}

  /* ALERTS LIST */
  .alerts-list{display:flex;flex-direction:column;gap:10px;}

  .alert-card{background:var(--dark-3);border:1px solid rgba(255,255,255,0.05);border-radius:12px;overflow:hidden;transition:border-color 0.2s;}
  .alert-card:hover{border-color:rgba(201,168,76,0.2);}
  .alert-card.has-new{border-color:rgba(201,168,76,0.3);}
  .alert-card.has-new::before{content:'';display:block;height:2px;background:var(--gold);}

  .alert-main{display:grid;grid-template-columns:auto 1fr auto auto;gap:16px;align-items:center;padding:16px 20px;}
  .alert-icon-wrap{width:42px;height:42px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:1.2rem;flex-shrink:0;}
  .alert-icon-wrap.active{background:var(--gold-dim);}
  .alert-icon-wrap.paused{background:rgba(255,255,255,0.04);}
  .alert-info{}
  .alert-name-row{display:flex;align-items:center;gap:8px;margin-bottom:3px;}
  .alert-name{font-family:'Syne',sans-serif;font-weight:700;font-size:0.9rem;}
  .alert-new-badge{font-size:0.6rem;font-weight:700;padding:2px 6px;border-radius:4px;background:var(--gold);color:var(--dark);font-family:'Syne',sans-serif;animation:pulse 2s infinite;}
  .alert-criteria{font-size:0.76rem;color:var(--cream-dim);}
  .alert-stats{display:flex;gap:16px;text-align:right;}
  .alert-stat{display:flex;flex-direction:column;gap:2px;}
  .alert-stat-val{font-family:'Syne',sans-serif;font-weight:700;font-size:0.88rem;}
  .alert-stat-label{font-size:0.62rem;color:rgba(212,204,184,0.4);text-transform:uppercase;letter-spacing:0.06em;}
  .alert-actions{display:flex;gap:6px;flex-shrink:0;}
  .alert-btn{width:32px;height:32px;border-radius:6px;border:1px solid rgba(255,255,255,0.08);background:none;color:var(--cream-dim);cursor:auto;transition:all 0.2s;display:flex;align-items:center;justify-content:center;font-size:0.85rem;}
  .alert-btn:hover{border-color:rgba(201,168,76,0.3);color:var(--cream);}
  .alert-btn.danger:hover{border-color:rgba(232,76,76,0.3);color:var(--red);}

  /* MATCHES */
  .alert-matches{border-top:1px solid rgba(255,255,255,0.04);padding:0;}
  .match-item{display:grid;grid-template-columns:1fr auto auto auto;gap:12px;align-items:center;padding:12px 20px;border-bottom:1px solid rgba(255,255,255,0.03);transition:background 0.2s;}
  .match-item:last-child{border-bottom:none;}
  .match-item:hover{background:rgba(255,255,255,0.02);}
  .match-name{font-size:0.82rem;font-weight:500;}
  .match-meta{font-size:0.72rem;color:var(--cream-dim);}
  .match-price{font-family:'Syne',sans-serif;font-weight:700;font-size:0.84rem;color:var(--gold);}
  .match-tag{font-size:0.62rem;padding:2px 7px;border-radius:4px;font-family:'Syne',sans-serif;font-weight:600;}
  .tag-hot{background:var(--gold-dim);color:var(--gold);}
  .tag-new{background:var(--green-dim);color:var(--green);}
  .tag-drop{background:var(--red-dim);color:var(--red);}
  .match-action{color:var(--blue);font-size:0.75rem;cursor:auto;text-decoration:none;white-space:nowrap;}
  .match-action:hover{text-decoration:underline;}

  /* EXPAND TOGGLE */
  .expand-btn{width:100%;padding:10px;border:none;background:rgba(255,255,255,0.02);color:var(--cream-dim);font-size:0.76rem;cursor:auto;transition:all 0.2s;border-top:1px solid rgba(255,255,255,0.04);display:flex;align-items:center;justify-content:center;gap:6px;}
  .expand-btn:hover{background:rgba(255,255,255,0.04);color:var(--cream);}

  /* EMPTY STATE */
  .empty-state{text-align:center;padding:60px 24px;color:rgba(212,204,184,0.3);}
  .empty-icon{font-size:3rem;margin-bottom:12px;}
  .empty-text{font-size:0.88rem;}

  @keyframes fadeUp{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:translateY(0)}}
  @keyframes pulse{0%,100%{opacity:1}50%{opacity:0.5}}
  .fade-in{animation:fadeUp 0.4s ease both;}
  .fade-in:nth-child(2){animation-delay:0.06s;}
  .fade-in:nth-child(3){animation-delay:0.12s;}

  /* â”€â”€ MOBILE RESPONSIVE â”€â”€ */
  .mobile-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.7);z-index:49;backdrop-filter:blur(4px);}
  .burger{display:none;flex-direction:column;gap:5px;cursor:auto;padding:8px;background:var(--dark-3);border:1px solid rgba(255,255,255,0.08);border-radius:8px;}
  .burger span{display:block;width:20px;height:2px;background:var(--cream);border-radius:2px;transition:all 0.3s;}
  .burger.open span:nth-child(1){transform:translateY(7px) rotate(45deg);}
  .burger.open span:nth-child(2){opacity:0;}
  .burger.open span:nth-child(3){transform:translateY(-7px) rotate(-45deg);}

  @media(max-width:900px){
    .sidebar{transform:translateX(-100%);transition:transform 0.3s ease;box-shadow:none;}
    .sidebar.open{transform:translateX(0);box-shadow:8px 0 40px rgba(0,0,0,0.5);}
    .mobile-overlay.show{display:block;}
    .main{margin-left:0 !important;}
    .burger{display:flex;}
    .content{padding:20px 16px !important;}
    .topbar{padding:14px 16px !important;}
    /* Stack grids on mobile */
    .stats-grid,.summary-grid,.hero-stats{grid-template-columns:1fr 1fr !important;}
    .bottom-grid,.main-grid,.comparison,.bottom-row{grid-template-columns:1fr !important;}
    .calc-layout,.settings-layout{grid-template-columns:1fr !important;}
    .district-grid{grid-template-columns:1fr 1fr !important;}
    .forecast-grid{grid-template-columns:1fr 1fr !important;}
    .alert-form{grid-template-columns:1fr 1fr !important;}
    .alert-main{grid-template-columns:auto 1fr !important;}
    .alert-stats,.alert-actions{display:none !important;}
    .plans-grid{grid-template-columns:1fr !important;}
    .chart-header{flex-direction:column !important;gap:12px !important;}
    .url-row,.url-input-wrap{flex-wrap:wrap !important;}
    .url-inp,.url-input{border-right:1px solid rgba(201,168,76,0.15) !important;border-radius:8px !important;margin-bottom:8px !important;width:100% !important;}
    .scan-btn,.analyze-btn{border-radius:8px !important;width:100% !important;justify-content:center !important;}
    .infra-grid{grid-template-columns:repeat(3,1fr) !important;}
    .chips-wrap{padding-bottom:8px !important;}
  }
  @media(max-width:500px){
    .stats-grid,.summary-grid,.hero-stats{grid-template-columns:1fr !important;}
    .district-grid,.forecast-grid{grid-template-columns:1fr !important;}
    .score-overview{grid-template-columns:1fr !important;}
    .score-main{border-right:none !important;border-bottom:1px solid rgba(255,255,255,0.05) !important;}
    .checks-grid{grid-template-columns:1fr !important;}
  }

  /* â”€â”€ PAGE TRANSITIONS â”€â”€ */
  body{opacity:0;animation:pageIn 0.35s ease forwards;}
  @keyframes pageIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
  .page-exit{animation:pageOut 0.25s ease forwards !important;}
  @keyframes pageOut{to{opacity:0;transform:translateY(-8px)}}

  /* â”€â”€ CURSOR FIX â”€â”€ */
  *, *::before, *::after { cursor: auto !important; }
  .cursor { cursor: auto !important; }
  @media (max-width: 900px) {
    *, *::before, *::after { cursor: auto !important; }
    .cursor, .cursor-ring { display: none !important; }
  }


  /* â”€â”€ SIDEBAR SCROLL FIX â”€â”€ */
  .sidebar {
    overflow-y: auto !important;
    overflow-x: hidden !important;
  }
  .sidebar::-webkit-scrollbar { width: 3px; }
  .sidebar::-webkit-scrollbar-track { background: transparent; }
  .sidebar::-webkit-scrollbar-thumb { background: rgba(201,168,76,0.2); border-radius: 3px; }
  .sidebar-bottom {
    position: sticky !important;
    bottom: 0 !important;
    background: var(--dark-2) !important;
    z-index: 2 !important;
    border-top: 1px solid rgba(255,255,255,0.05) !important;
  }


  /* â”€â”€ CURSOR OVERRIDE â”€â”€ */
  *, *::before, *::after { cursor: auto !important; }
  .cursor, .cursor-ring { display: none !important; }
  a, button, [onclick], select, input, label { cursor: pointer !important; }
</style>

  <!-- ImotIQ Config -->
  <script>
    const IMOTIQ_CONFIG = {
      BACKEND_URL: 'https://script.google.com/macros/s/AKfycbwZMP-d3ZLxuVx55YdTaXg0VGjqJtQAEUs-eKVDgEKTkJBNr8JfCXBXulFtN9F26_KlqA/exec',
      VERSION: '1.0',
    };

    // â”€â”€ API HELPER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    async function apiCall(action, data = {}) {
      try {
        const res = await fetch(IMOTIQ_CONFIG.BACKEND_URL, {
          method: 'POST',
          body: JSON.stringify({ action, ...data }),
        });
        return await res.json();
      } catch(e) {
        console.error('API error:', e);
        return { success: false, error: e.message };
      }
    }

    // â”€â”€ SESSION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function getSession() { return localStorage.getItem('imotiq_session'); }
    function getUser()    { return JSON.parse(localStorage.getItem('imotiq_user') || 'null'); }

    function checkSession() {
      if(!getSession() && !window.location.href.includes('landing')) {
        window.location.href = 'imotiq-landing.html';
      }
    }

    // â”€â”€ LOGOUT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    async function logout() {
      await apiCall('logout', { sessionId: getSession() });
      localStorage.clear();
      window.location.href = 'imotiq-landing.html';
    }
  </script>

</head>
<body>
<script>
    // â”€â”€ ĞŸĞ ĞĞ’Ğ•Ğ ĞšĞ ĞĞ Ğ¡Ğ•Ğ¡Ğ˜Ğ¯ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    (function() {
      var sess = localStorage.getItem('imotiq_session');
      var user = JSON.parse(localStorage.getItem('imotiq_user') || 'null');
      // ĞĞºĞ¾ Ğ½ÑĞ¼Ğ° ÑĞµÑĞ¸Ñ Ğ¸Ğ»Ğ¸ Ğµ Ñ„Ğ°Ğ»ÑˆĞ¸Ğ²Ğ°Ñ‚Ğ° Ñ‚ĞµÑÑ‚Ğ¾Ğ²Ğ° â€” Ğ²ÑŠÑ€Ğ½Ğ¸ ĞºÑŠĞ¼ landing
      if (!sess || !user || user.email === 'test@example.bg' || user.id === 'user_001') {
        localStorage.clear();
        window.location.replace('imotiq-landing.html');
      }
    })();
</script>
<div class="cursor" id="cursor"></div>
<div class="cursor-ring" id="cursorRing"></div>

<!-- SIDEBAR -->
<aside class="sidebar">
  <div class="sidebar-logo">Imot<span>IQ</span></div>
  <div style="padding:12px 8px 0;">
    <div class="sidebar-section">Ğ“Ğ»Ğ°Ğ²Ğ½Ğ¾</div>
    <a class="nav-item" href="imotiq-dashboard.html"><span class="nav-icon">âš¡</span> Dashboard</a>
    <a class="nav-item" href="imotiq-dashboard.html"><span class="nav-icon">ğŸ§ </span> AI ĞĞ½Ğ°Ğ»Ğ¸Ğ·</a>
    <a class="nav-item active" href="#"><span class="nav-icon">ğŸ””</span> ĞœĞ¾Ğ¸Ñ‚Ğµ Alerts<span class="nav-badge">3</span></a>
    <div class="sidebar-section">ĞŸĞ°Ğ·Ğ°Ñ€</div>
    <a class="nav-item" href="imotiq-tracker.html"><span class="nav-icon">ğŸ“Š</span> ĞšĞ²Ğ°Ñ€Ñ‚Ğ°Ğ»ĞµĞ½ Ğ¢Ñ€ĞµĞºĞµÑ€</a>
    <a class="nav-item" href="imotiq-trend.html"><span class="nav-icon">ğŸ“ˆ</span> Ğ¦ĞµĞ½Ğ¾Ğ²Ğ¸ Ğ¢Ñ€ĞµĞ½Ğ´</a>
    <a class="nav-item" href="imotiq-report.html"><span class="nav-icon">ğŸ˜ï¸</span> ĞšĞ²Ğ°Ñ€Ñ‚Ğ°Ğ»ĞµĞ½ Ğ”Ğ¾ĞºĞ»Ğ°Ğ´</a>
    <div class="sidebar-section">Ğ˜Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚Ğ¸</div>
    <a class="nav-item" href="imotiq-calculator.html"><span class="nav-icon">âš–ï¸</span> ĞĞ°ĞµĞ¼ vs ĞšÑƒĞ¿ÑƒĞ²Ğ°Ğ½Ğµ</a>
    <a class="nav-item" href="imotiq-detector.html"><span class="nav-icon">ğŸ”</span> Ğ¤Ğ°Ğ»ÑˆĞ¸Ğ²Ğ¸ ĞĞ±ÑĞ²Ğ¸</a>
    <a class="nav-item" href="imotiq-history.html"><span class="nav-icon">ğŸ“‹</span> Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ</a>
    <div class="sidebar-section">ĞĞºĞ°ÑƒĞ½Ñ‚</div>
    <a class="nav-item" href="imotiq-settings.html"><span class="nav-icon">âš™ï¸</span> ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸</a>
  </div>
  <div class="sidebar-bottom">
    <div class="plan-widget">
      <div class="plan-name">ğŸ†“ Ğ‘ĞµĞ·Ğ¿Ğ»Ğ°Ñ‚ĞµĞ½ Ğ¿Ğ»Ğ°Ğ½</div>
      <div class="plan-usage">1 Ğ¾Ñ‚ 1 Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ° Ğ¸Ğ·Ğ¿Ğ¾Ğ»Ğ·Ğ²Ğ°Ğ½</div>
      <div class="usage-bar"><div class="usage-fill" style="width:100%"></div></div>
      <a href="#" class="upgrade-btn">ĞĞ°Ğ´Ğ³Ñ€Ğ°Ğ´Ğ¸ ĞºÑŠĞ¼ Ğ¡Ñ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚ â†’</a>
    </div>
    <div class="user-row">
      <div class="avatar">Ğ˜Ğ˜</div>
      <div><div class="user-name">Ğ˜Ğ²Ğ°Ğ½ Ğ˜Ğ²Ğ°Ğ½Ğ¾Ğ²</div><div class="user-plan">Ğ‘ĞµĞ·Ğ¿Ğ»Ğ°Ñ‚ĞµĞ½ Ğ¿Ğ»Ğ°Ğ½</div></div>
      <button class="logout-btn" onclick="logout()">â»</button>
    </div>
  </div>
</aside>

<!-- MAIN -->
<main class="main">
  <div class="topbar">
    <div class="page-title">ğŸ”” ĞœĞ¾Ğ¸Ñ‚Ğµ Alerts</div>
    <div style="display:flex;align-items:center;gap:12px;">
      <div style="font-size:0.78rem;color:var(--cream-dim)" id="currentDate"></div>
      <div class="notif-btn">ğŸ””<div class="notif-dot"></div></div>
    </div>
  </div>

  <div class="content">

    <!-- STATS -->
    <div class="stats-row">
      <div class="stat-box fade-in">
        <div class="sb-label">ĞĞºÑ‚Ğ¸Ğ²Ğ½Ğ¸ Alerts</div>
        <div class="sb-val">3</div>
        <div class="sb-sub">Ğ¾Ñ‚ 3 Ğ¼Ğ°ĞºÑĞ¸Ğ¼ÑƒĞ¼ (Ğ±ĞµĞ·Ğ¿Ğ»Ğ°Ñ‚ĞµĞ½)</div>
      </div>
      <div class="stat-box fade-in">
        <div class="sb-label">ĞĞ¾Ğ²Ğ¸ ÑÑŠĞ²Ğ¿Ğ°Ğ´ĞµĞ½Ğ¸Ñ</div>
        <div class="sb-val" style="color:var(--gold)">7</div>
        <div class="sb-sub">Ğ¾Ñ‚ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¾Ñ‚Ğ¾ Ğ²Ğ»Ğ¸Ğ·Ğ°Ğ½Ğµ</div>
      </div>
      <div class="stat-box fade-in">
        <div class="sb-label">ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½Ğ¾ ÑĞºĞ°Ğ½Ğ¸Ñ€Ğ°Ğ½Ğµ</div>
        <div class="sb-val" style="font-size:1.1rem;">ĞŸÑ€ĞµĞ´Ğ¸ 2Ñ‡</div>
        <div class="sb-sub">ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡Ğ½Ğ¾ Ğ½Ğ° 6 Ñ‡Ğ°ÑĞ°</div>
      </div>
      <div class="stat-box fade-in" style="border-color:rgba(201,168,76,0.2);background:rgba(201,168,76,0.04);">
        <div class="sb-label">Ğ˜ÑĞºĞ°Ñˆ Ğ¿Ğ¾Ğ²ĞµÑ‡Ğµ alerts?</div>
        <div class="sb-val" style="font-size:1rem;color:var(--gold)">Ğ”Ğ¾ 20</div>
        <div class="sb-sub"><a href="imotiq-settings.html" style="color:var(--gold);text-decoration:none;">ĞĞ°Ğ´Ğ³Ñ€Ğ°Ğ´Ğ¸ Ğ´Ğ¾ Ğ¡Ñ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚ â†’</a></div>
      </div>
    </div>

    <!-- NEW ALERT -->
    <div class="new-alert-card fade-in">
      <div class="nac-title">â• Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸ Ğ½Ğ¾Ğ² Alert</div>
      <div class="alert-form">
        <div class="form-field">
          <div class="form-label">ĞšĞ²Ğ°Ñ€Ñ‚Ğ°Ğ»</div>
          <select class="form-select">
            <option>ğŸ™ï¸ Ğ›Ğ¾Ğ·ĞµĞ½ĞµÑ†</option>
            <option>ğŸ¢ ĞœĞ»Ğ°Ğ´Ğ¾ÑÑ‚</option>
            <option>ğŸŒ¿ Ğ’Ğ¸Ñ‚Ğ¾ÑˆĞ°</option>
            <option>ğŸ˜ï¸ ĞĞ°Ğ´ĞµĞ¶Ğ´Ğ°</option>
            <option>ğŸŒ² Ğ¡Ğ¸Ğ¼ĞµĞ¾Ğ½Ğ¾Ğ²Ğ¾</option>
            <option>ğŸ¡ Ğ‘Ğ¾ÑĞ½Ğ°</option>
            <option>ğŸ—ï¸ Ğ›ÑĞ»Ğ¸Ğ½</option>
            <option>ğŸ“ Ğ¡Ñ‚ÑƒĞ´ĞµĞ½Ñ‚ÑĞºĞ¸</option>
          </select>
        </div>
        <div class="form-field">
          <div class="form-label">ĞœĞ°ĞºÑĞ¸Ğ¼Ğ°Ğ»Ğ½Ğ° Ñ†ĞµĞ½Ğ°</div>
          <input class="form-input" type="text" placeholder="Ğ½Ğ°Ğ¿Ñ€. 300000 Ğ»Ğ²">
        </div>
        <div class="form-field">
          <div class="form-label">Ğ¢Ğ¸Ğ¿ Ğ¸Ğ¼Ğ¾Ñ‚</div>
          <select class="form-select">
            <option>ğŸ  Ğ’ÑĞ¸Ñ‡ĞºĞ¸</option>
            <option>ğŸ›‹ï¸ ĞĞ¿Ğ°Ñ€Ñ‚Ğ°Ğ¼ĞµĞ½Ñ‚</option>
            <option>ğŸ¡ ĞšÑŠÑ‰Ğ°</option>
            <option>ğŸ“¦ Ğ¡Ñ‚ÑƒĞ´Ğ¸Ğ¾</option>
          </select>
        </div>
        <button class="add-btn" onclick="addAlert()">+ Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸</button>
      </div>
    </div>

    <!-- TABS -->
    <div class="tabs">
      <button class="tab active" onclick="setTab(this,'all')">Ğ’ÑĞ¸Ñ‡ĞºĞ¸ (3)</button>
      <button class="tab" onclick="setTab(this,'new')">ĞĞ¾Ğ²Ğ¸ ÑÑŠĞ²Ğ¿Ğ°Ğ´ĞµĞ½Ğ¸Ñ (7)</button>
      <button class="tab" onclick="setTab(this,'paused')">ĞŸĞ°ÑƒĞ·Ğ¸Ñ€Ğ°Ğ½Ğ¸ (0)</button>
    </div>

    <!-- ALERTS LIST -->
    <div class="alerts-list" id="alertsList">

      <!-- ALERT 1 â€” with matches expanded -->
      <div class="alert-card has-new fade-in">
        <div class="alert-main">
          <div class="alert-icon-wrap active">ğŸ™ï¸</div>
          <div class="alert-info">
            <div class="alert-name-row">
              <div class="alert-name">Ğ›Ğ¾Ğ·ĞµĞ½ĞµÑ† â€” Ğ´Ğ¾ 300,000 Ğ»Ğ²</div>
              <span class="alert-new-badge">3 ĞĞĞ’Ğ˜</span>
            </div>
            <div class="alert-criteria">ĞĞ¿Ğ°Ñ€Ñ‚Ğ°Ğ¼ĞµĞ½Ñ‚ Â· Ğ›Ğ¾Ğ·ĞµĞ½ĞµÑ† Â· ĞœĞ°ĞºÑ 300,000 Ğ»Ğ² Â· Ğ’ÑĞ¸Ñ‡ĞºĞ¸ Ñ€Ğ°Ğ·Ğ¼ĞµÑ€Ğ¸ Â· Ğ¡ĞºĞ°Ğ½Ğ¸Ñ€Ğ° Ğ½Ğ° 6Ñ‡</div>
          </div>
          <div class="alert-stats">
            <div class="alert-stat">
              <div class="alert-stat-val" style="color:var(--gold)">3</div>
              <div class="alert-stat-label">ĞĞ¾Ğ²Ğ¸</div>
            </div>
            <div class="alert-stat">
              <div class="alert-stat-val">47</div>
              <div class="alert-stat-label">ĞĞ±Ñ‰Ğ¾</div>
            </div>
          </div>
          <div class="alert-actions">
            <button class="alert-btn" title="ĞŸĞ°ÑƒĞ·Ğ°">â¸</button>
            <button class="alert-btn" title="Ğ ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ°Ğ¹">âœï¸</button>
            <button class="alert-btn danger" title="Ğ˜Ğ·Ñ‚Ñ€Ğ¸Ğ¹" onclick="deleteAlert(this)">ğŸ—‘ï¸</button>
          </div>
        </div>
        <div class="alert-matches">
          <div class="match-item">
            <div>
              <div class="match-name">3-ÑÑ‚Ğ°ĞµĞ½, 92 Ğ¼Â², ĞµÑ‚.4</div>
              <div class="match-meta">Ğ±ÑƒĞ». Ğ§ĞµÑ€Ğ½Ğ¸ Ğ’Ñ€ÑŠÑ… 45 Â· ĞŸÑƒĞ±Ğ»Ğ¸ĞºÑƒĞ²Ğ°Ğ½ Ğ¿Ñ€ĞµĞ´Ğ¸ 2Ñ‡</div>
            </div>
            <div class="match-price">278,000 Ğ»Ğ²</div>
            <span class="match-tag tag-hot">ğŸ”¥ -8% Ğ¿Ğ¾Ğ´ Ğ¿Ğ°Ğ·Ğ°Ñ€Ğ°</span>
            <a href="#" class="match-action" onclick="analyzeFromAlert(this)" data-url="">ĞĞ½Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ°Ğ¹ â†’</a>
          </div>
          <div class="match-item">
            <div>
              <div class="match-name">2-ÑÑ‚Ğ°ĞµĞ½, 68 Ğ¼Â², ĞµÑ‚.2</div>
              <div class="match-meta">ÑƒĞ». Ğ¥ĞµĞ¼ÑƒÑ 12 Â· ĞŸÑƒĞ±Ğ»Ğ¸ĞºÑƒĞ²Ğ°Ğ½ Ğ¿Ñ€ĞµĞ´Ğ¸ 5Ñ‡</div>
            </div>
            <div class="match-price">245,000 Ğ»Ğ²</div>
            <span class="match-tag tag-new">âœ¨ ĞĞ¾Ğ²Ğ°</span>
            <a href="#" class="match-action" onclick="analyzeFromAlert(this)" data-url="">ĞĞ½Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ°Ğ¹ â†’</a>
          </div>
          <div class="match-item">
            <div>
              <div class="match-name">4-ÑÑ‚Ğ°ĞµĞ½, 120 Ğ¼Â², ĞµÑ‚.6</div>
              <div class="match-meta">ÑƒĞ». ĞÑ‚Ğ°Ğ½Ğ°Ñ Ğ”Ğ°Ğ»Ñ‡ĞµĞ² 8 Â· ĞŸÑƒĞ±Ğ»Ğ¸ĞºÑƒĞ²Ğ°Ğ½ Ğ²Ñ‡ĞµÑ€Ğ°</div>
            </div>
            <div class="match-price">299,000 Ğ»Ğ²</div>
            <span class="match-tag tag-new">âœ¨ ĞĞ¾Ğ²Ğ°</span>
            <a href="#" class="match-action" onclick="analyzeFromAlert(this)" data-url="">ĞĞ½Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ°Ğ¹ â†’</a>
          </div>
        </div>
        <button class="expand-btn">Ğ’Ğ¸Ğ¶ Ğ²ÑĞ¸Ñ‡ĞºĞ¸ 47 ÑÑŠĞ²Ğ¿Ğ°Ğ´ĞµĞ½Ğ¸Ñ â†“</button>
      </div>

      <!-- ALERT 2 -->
      <div class="alert-card has-new fade-in">
        <div class="alert-main">
          <div class="alert-icon-wrap active">ğŸ¢</div>
          <div class="alert-info">
            <div class="alert-name-row">
              <div class="alert-name">ĞœĞ»Ğ°Ğ´Ğ¾ÑÑ‚ â€” Ğ´Ğ¾ 180,000 Ğ»Ğ²</div>
              <span class="alert-new-badge">2 ĞĞĞ’Ğ˜</span>
            </div>
            <div class="alert-criteria">ĞĞ¿Ğ°Ñ€Ñ‚Ğ°Ğ¼ĞµĞ½Ñ‚ Â· ĞœĞ»Ğ°Ğ´Ğ¾ÑÑ‚ 1, 2, 3 Â· ĞœĞ°ĞºÑ 180,000 Ğ»Ğ² Â· ĞœĞ¸Ğ½ 60 Ğ¼Â² Â· Ğ¡ĞºĞ°Ğ½Ğ¸Ñ€Ğ° Ğ½Ğ° 6Ñ‡</div>
          </div>
          <div class="alert-stats">
            <div class="alert-stat">
              <div class="alert-stat-val" style="color:var(--gold)">2</div>
              <div class="alert-stat-label">ĞĞ¾Ğ²Ğ¸</div>
            </div>
            <div class="alert-stat">
              <div class="alert-stat-val">31</div>
              <div class="alert-stat-label">ĞĞ±Ñ‰Ğ¾</div>
            </div>
          </div>
          <div class="alert-actions">
            <button class="alert-btn" title="ĞŸĞ°ÑƒĞ·Ğ°">â¸</button>
            <button class="alert-btn" title="Ğ ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ°Ğ¹">âœï¸</button>
            <button class="alert-btn danger" title="Ğ˜Ğ·Ñ‚Ñ€Ğ¸Ğ¹" onclick="deleteAlert(this)">ğŸ—‘ï¸</button>
          </div>
        </div>
        <div class="alert-matches">
          <div class="match-item">
            <div>
              <div class="match-name">2-ÑÑ‚Ğ°ĞµĞ½, 65 Ğ¼Â², ĞµÑ‚.3</div>
              <div class="match-meta">Ğ±ÑƒĞ». ĞĞ»ĞµĞºÑĞ°Ğ½Ğ´ÑŠÑ€ ĞœĞ°Ğ»Ğ¸Ğ½Ğ¾Ğ² 51 Â· ĞŸÑ€ĞµĞ´Ğ¸ 4Ñ‡</div>
            </div>
            <div class="match-price">168,000 Ğ»Ğ²</div>
            <span class="match-tag tag-drop">ğŸ“‰ ĞŸĞ¾ĞµĞ²Ñ‚Ğ¸Ğ½Ñ Ñ 8K</span>
            <a href="#" class="match-action" onclick="analyzeFromAlert(this)" data-url="">ĞĞ½Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ°Ğ¹ â†’</a>
          </div>
          <div class="match-item">
            <div>
              <div class="match-name">3-ÑÑ‚Ğ°ĞµĞ½, 82 Ğ¼Â², ĞµÑ‚.7</div>
              <div class="match-meta">ÑƒĞ». Ğ”-Ñ€ Ğ“. Ğœ. Ğ”Ğ¸Ğ¼Ğ¸Ñ‚Ñ€Ğ¾Ğ² 22 Â· Ğ’Ñ‡ĞµÑ€Ğ°</div>
            </div>
            <div class="match-price">175,000 Ğ»Ğ²</div>
            <span class="match-tag tag-new">âœ¨ ĞĞ¾Ğ²Ğ°</span>
            <a href="#" class="match-action" onclick="analyzeFromAlert(this)" data-url="">ĞĞ½Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ°Ğ¹ â†’</a>
          </div>
        </div>
        <button class="expand-btn">Ğ’Ğ¸Ğ¶ Ğ²ÑĞ¸Ñ‡ĞºĞ¸ 31 ÑÑŠĞ²Ğ¿Ğ°Ğ´ĞµĞ½Ğ¸Ñ â†“</button>
      </div>

      <!-- ALERT 3 â€” no new -->
      <div class="alert-card fade-in">
        <div class="alert-main">
          <div class="alert-icon-wrap active">ğŸŒ¿</div>
          <div class="alert-info">
            <div class="alert-name-row">
              <div class="alert-name">Ğ’Ğ¸Ñ‚Ğ¾ÑˆĞ° â€” Ğ´Ğ¾ 250,000 Ğ»Ğ²</div>
            </div>
            <div class="alert-criteria">ĞĞ¿Ğ°Ñ€Ñ‚Ğ°Ğ¼ĞµĞ½Ñ‚ Â· Ğ’Ğ¸Ñ‚Ğ¾ÑˆĞ° Â· ĞœĞ°ĞºÑ 250,000 Ğ»Ğ² Â· Ğ’ÑĞ¸Ñ‡ĞºĞ¸ Ñ€Ğ°Ğ·Ğ¼ĞµÑ€Ğ¸ Â· Ğ¡ĞºĞ°Ğ½Ğ¸Ñ€Ğ° Ğ½Ğ° 6Ñ‡</div>
          </div>
          <div class="alert-stats">
            <div class="alert-stat">
              <div class="alert-stat-val" style="color:rgba(212,204,184,0.3)">0</div>
              <div class="alert-stat-label">ĞĞ¾Ğ²Ğ¸</div>
            </div>
            <div class="alert-stat">
              <div class="alert-stat-val">18</div>
              <div class="alert-stat-label">ĞĞ±Ñ‰Ğ¾</div>
            </div>
          </div>
          <div class="alert-actions">
            <button class="alert-btn" title="ĞŸĞ°ÑƒĞ·Ğ°">â¸</button>
            <button class="alert-btn" title="Ğ ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ°Ğ¹">âœï¸</button>
            <button class="alert-btn danger" title="Ğ˜Ğ·Ñ‚Ñ€Ğ¸Ğ¹" onclick="deleteAlert(this)">ğŸ—‘ï¸</button>
          </div>
        </div>
        <button class="expand-btn">Ğ’Ğ¸Ğ¶ Ğ²ÑĞ¸Ñ‡ĞºĞ¸ 18 ÑÑŠĞ²Ğ¿Ğ°Ğ´ĞµĞ½Ğ¸Ñ â†“</button>
      </div>

    </div>
  </div>
</main>

<script>
  document.getElementById('currentDate').textContent = new Date().toLocaleDateString('bg-BG',{weekday:'long',day:'numeric',month:'long'});

  function setTab(btn, tab) {
    document.querySelectorAll('.tab').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
  }

  function addAlert() {
    const btn = document.querySelector('.add-btn');
    btn.textContent = 'âœ“ Ğ”Ğ¾Ğ±Ğ°Ğ²ĞµĞ½!';
    btn.style.background = 'var(--green)';
    setTimeout(() => { btn.textContent = '+ Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸'; btn.style.background = ''; }, 2000);
  }

  function deleteAlert(btn) {
    const card = btn.closest('.alert-card');
    card.style.opacity = '0';
    card.style.transform = 'translateX(20px)';
    card.style.transition = 'all 0.3s ease';
    setTimeout(() => card.remove(), 300);
  }

  // Expand toggle
  document.querySelectorAll('.expand-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      const matches = btn.previousElementSibling;
      if(matches && matches.classList.contains('alert-matches')) {
        const isHidden = matches.style.display === 'none';
        matches.style.display = isHidden ? 'block' : 'none';
        btn.textContent = isHidden ? 'Ğ¡ĞºÑ€Ğ¸Ğ¹ â†‘' : btn.textContent.replace('Ğ¡ĞºÑ€Ğ¸Ğ¹ â†‘', btn.dataset.original || btn.textContent);
      }
    });
  });


  // â”€â”€ Ğ Ğ•ĞĞ›Ğ•Ğ BACKEND Ğ—Ğ ALERTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const BACKEND = 'https://script.google.com/macros/s/AKfycbwZMP-d3ZLxuVx55YdTaXg0VGjqJtQAEUs-eKVDgEKTkJBNr8JfCXBXulFtN9F26_KlqA/exec';

  async function api(action, data) {
    try {
      const res = await fetch(BACKEND, {
        method: 'POST',
        body: JSON.stringify({ action, sessionId: localStorage.getItem('imotiq_session'), ...data }),
      });
      return await res.json();
    } catch(e) { return { success: false, error: e.message }; }
  }

  // Ğ—Ğ°Ñ€ĞµĞ´Ğ¸ alerts Ğ¾Ñ‚ backend Ğ¿Ñ€Ğ¸ Ğ·Ğ°Ñ€ĞµĞ¶Ğ´Ğ°Ğ½Ğµ Ğ½Ğ° ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ°Ñ‚Ğ°
  async function loadAlerts() {
    const listEl = document.getElementById('alertsList');
    if (!listEl) return;

    const result = await api('getAlerts');
    if (!result.success || !result.alerts || result.alerts.length === 0) {
      // ĞÑĞ¼Ğ°Ğ¼Ğµ Ñ€ĞµĞ°Ğ»Ğ½Ğ¸ alerts â€” Ğ¿Ğ¾ĞºĞ°Ğ¶Ğ¸ empty state
      listEl.innerHTML = `
        <div class="empty-state">
          <div class="empty-icon">ğŸ””</div>
          <div class="empty-text">ĞÑĞ¼Ğ°Ñˆ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ¸ alerts.<br>Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸ ÑĞ²Ğ¾Ñ Ğ¿ÑŠÑ€Ğ²Ğ¸ alert Ğ¿Ğ¾-Ğ³Ğ¾Ñ€Ğµ!</div>
        </div>`;
      // ĞĞ±Ğ½Ğ¾Ğ²Ğ¸ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ¸Ñ‚Ğµ
      document.querySelectorAll('.sb-val')[0].textContent = '0';
      document.querySelectorAll('.sb-val')[1].textContent = '0';
      return;
    }

    // Ğ ĞµĞ½Ğ´ĞµÑ€Ğ¸Ñ€Ğ°Ğ¹ Ñ€ĞµĞ°Ğ»Ğ½Ğ¸Ñ‚Ğµ alerts
    listEl.innerHTML = result.alerts.map(a => `
      <div class="alert-card ${a.matchesTotal > 0 ? 'has-new' : ''} fade-in" data-id="${a.id}">
        <div class="alert-main">
          <div class="alert-icon-wrap ${a.active ? 'active' : 'paused'}">
            ${getDistrictEmoji(a.district)}
          </div>
          <div class="alert-info">
            <div class="alert-name-row">
              <div class="alert-name">${a.district} â€” Ğ´Ğ¾ ${Number(a.maxPrice).toLocaleString('bg')} Ğ»Ğ²</div>
              ${a.matchesTotal > 0 ? `<span class="alert-new-badge">${a.matchesTotal} ĞĞĞ’Ğ˜</span>` : ''}
            </div>
            <div class="alert-criteria">
              ${a.propertyType !== 'all' ? a.propertyType : 'Ğ’ÑĞ¸Ñ‡ĞºĞ¸ Ñ‚Ğ¸Ğ¿Ğ¾Ğ²Ğµ'} Â· 
              ${a.district} Â· 
              ĞœĞ°ĞºÑ ${Number(a.maxPrice).toLocaleString('bg')} Ğ»Ğ²
              ${a.minSize > 0 ? ' Â· ĞœĞ¸Ğ½ ' + a.minSize + ' Ğ¼Â²' : ''}
            </div>
          </div>
          <div class="alert-stats">
            <div class="alert-stat">
              <div class="alert-stat-val" style="color:${a.matchesTotal > 0 ? 'var(--gold)' : 'rgba(212,204,184,0.3)'}">${a.matchesTotal || 0}</div>
              <div class="alert-stat-label">ĞĞ¾Ğ²Ğ¸</div>
            </div>
          </div>
          <div class="alert-actions">
            <button class="alert-btn" title="${a.active ? 'ĞŸĞ°ÑƒĞ·Ğ°' : 'ĞĞºÑ‚Ğ¸Ğ²Ğ¸Ñ€Ğ°Ğ¹'}" onclick="toggleAlert('${a.id}', ${a.active})">
              ${a.active ? 'â¸' : 'â–¶'}
            </button>
            <button class="alert-btn danger" title="Ğ˜Ğ·Ñ‚Ñ€Ğ¸Ğ¹" onclick="deleteAlertReal('${a.id}', this)">ğŸ—‘ï¸</button>
          </div>
        </div>
      </div>
    `).join('');

    // ĞĞ±Ğ½Ğ¾Ğ²Ğ¸ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ¸
    document.querySelectorAll('.sb-val')[0].textContent = result.alerts.filter(a => a.active).length;
    document.querySelectorAll('.sb-val')[1].textContent = result.alerts.reduce((s,a) => s + (a.matchesTotal||0), 0);
  }

  function getDistrictEmoji(district) {
    const map = {'Ğ›Ğ¾Ğ·ĞµĞ½ĞµÑ†':'ğŸ™ï¸','ĞœĞ»Ğ°Ğ´Ğ¾ÑÑ‚':'ğŸ¢','Ğ’Ğ¸Ñ‚Ğ¾ÑˆĞ°':'ğŸŒ¿','Ğ¡Ğ¸Ğ¼ĞµĞ¾Ğ½Ğ¾Ğ²Ğ¾':'ğŸŒ²','Ğ‘Ğ¾ÑĞ½Ğ°':'ğŸ¡','ĞĞ°Ğ´ĞµĞ¶Ğ´Ğ°':'ğŸ˜ï¸','Ğ›ÑĞ»Ğ¸Ğ½':'ğŸ—ï¸','Ğ¡Ñ‚ÑƒĞ´ĞµĞ½Ñ‚ÑĞºĞ¸':'ğŸ“'};
    return map[district] || 'ğŸ“';
  }

  // Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸ Ğ½Ğ¾Ğ² alert
  async function addAlert() {
    const btn = document.querySelector('.add-btn');
    const district = document.querySelector('.form-select').value.replace(/^[^ ]+ /, '');
    const maxPrice = parseInt(document.querySelectorAll('.form-input')[0]?.value?.replace(/\D/g,'') || '0');
    const propType = document.querySelectorAll('.form-select')[1]?.value?.replace(/^[^ ]+ /, '') || 'all';

    if (!maxPrice || maxPrice < 10000) {
      document.querySelector('.form-input').style.borderColor = 'var(--red)';
      setTimeout(() => document.querySelector('.form-input').style.borderColor = '', 2000);
      return;
    }

    btn.textContent = 'â³ Ğ—Ğ°Ğ¿Ğ°Ğ·Ğ²Ğ°...';
    btn.disabled = true;

    const result = await api('saveAlert', {
      alert: { district, maxPrice, minPrice: 0, propertyType: propType, minSize: 0, maxSize: 0 }
    });

    if (result.success) {
      btn.textContent = 'âœ“ Ğ”Ğ¾Ğ±Ğ°Ğ²ĞµĞ½!';
      btn.style.background = 'var(--green)';
      setTimeout(() => {
        btn.textContent = '+ Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸';
        btn.style.background = '';
        btn.disabled = false;
        loadAlerts(); // ĞŸÑ€ĞµĞ·Ğ°Ñ€ĞµĞ´Ğ¸
      }, 1500);
    } else {
      btn.textContent = result.message || 'Ğ“Ñ€ĞµÑˆĞºĞ°!';
      btn.style.background = 'var(--red)';
      setTimeout(() => { btn.textContent = '+ Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸'; btn.style.background = ''; btn.disabled = false; }, 3000);
    }
  }

  // Ğ˜Ğ·Ñ‚Ñ€Ğ¸Ğ¹ alert
  async function deleteAlertReal(alertId, btn) {
    const card = btn.closest('.alert-card');
    card.style.opacity = '0.5';

    const result = await api('deleteAlert', { alertId });
    if (result.success) {
      card.style.transition = 'all 0.3s';
      card.style.opacity = '0';
      card.style.transform = 'translateX(20px)';
      setTimeout(() => { card.remove(); loadAlerts(); }, 300);
    } else {
      card.style.opacity = '1';
      alert('Ğ“Ñ€ĞµÑˆĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¸Ğ·Ñ‚Ñ€Ğ¸Ğ²Ğ°Ğ½Ğµ');
    }
  }

  // ĞŸĞ°ÑƒĞ·Ğ°/ĞĞºÑ‚Ğ¸Ğ²Ğ¸Ñ€Ğ°Ğ½Ğµ
  async function toggleAlert(alertId, currentActive) {
    // Ğ—Ğ° Ğ¼Ğ¾Ğ¼ĞµĞ½Ñ‚Ğ° ÑĞ°Ğ¼Ğ¾ UI â€” backend toggle Ğ¸Ğ´Ğ²Ğ° Ğ² ÑĞ»ĞµĞ´Ğ²Ğ°Ñ‰Ğ° Ğ²ĞµÑ€ÑĞ¸Ñ
    const card = document.querySelector(`[data-id="${alertId}"]`);
    if (card) {
      const icon = card.querySelector('.alert-icon-wrap');
      if (icon) icon.className = `alert-icon-wrap ${currentActive ? 'paused' : 'active'}`;
    }
  }

  // Ğ—Ğ°Ñ€ĞµĞ´Ğ¸ Ğ¿Ñ€Ğ¸ ÑÑ‚Ğ°Ñ€Ñ‚
  window.addEventListener('load', loadAlerts);

  // CURSOR
  const cursor=document.getElementById('cursor'), ring=document.getElementById('cursorRing');
  let mx=0,my=0,rx=0,ry=0;
  document.addEventListener('mousemove',e=>{ mx=e.clientX; my=e.clientY; cursor.style.left=mx-5+'px'; cursor.style.top=my-5+'px'; });
  function animRing(){ rx+=(mx-rx-16)*0.12; ry+=(my-ry-16)*0.12; ring.style.left=rx+'px'; ring.style.top=ry+'px'; requestAnimationFrame(animRing); }
  animRing();
  document.querySelectorAll('a,button,input,select').forEach(el=>{ el.addEventListener('mouseenter',()=>cursor.style.transform='scale(2.5)'); el.addEventListener('mouseleave',()=>cursor.style.transform='scale(1)'); });

  
  function analyzeFromAlert(el) {
    const url = el.getAttribute('data-url') || el.closest('.match-item')?.querySelector('.match-name')?.getAttribute('data-url');
    if (url) {
      localStorage.setItem('imotiq_analyze_url', url);
    }
    window.location.href = 'imotiq-dashboard.html';
  }


  // â”€â”€ Ğ Ğ•ĞĞ›Ğ•Ğ BACKEND Ğ—Ğ ALERTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const BACKEND = 'https://script.google.com/macros/s/AKfycbwZMP-d3ZLxuVx55YdTaXg0VGjqJtQAEUs-eKVDgEKTkJBNr8JfCXBXulFtN9F26_KlqA/exec';

  async function api(action, data) {
    try {
      const res = await fetch(BACKEND, {
        method: 'POST',
        body: JSON.stringify({ action, sessionId: localStorage.getItem('imotiq_session'), ...data }),
      });
      return await res.json();
    } catch(e) { return { success: false, error: e.message }; }
  }

  // Ğ—Ğ°Ñ€ĞµĞ´Ğ¸ alerts Ğ¾Ñ‚ backend Ğ¿Ñ€Ğ¸ Ğ·Ğ°Ñ€ĞµĞ¶Ğ´Ğ°Ğ½Ğµ Ğ½Ğ° ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ°Ñ‚Ğ°
  async function loadAlerts() {
    const listEl = document.getElementById('alertsList');
    if (!listEl) return;

    const result = await api('getAlerts');
    if (!result.success || !result.alerts || result.alerts.length === 0) {
      // ĞÑĞ¼Ğ°Ğ¼Ğµ Ñ€ĞµĞ°Ğ»Ğ½Ğ¸ alerts â€” Ğ¿Ğ¾ĞºĞ°Ğ¶Ğ¸ empty state
      listEl.innerHTML = `
        <div class="empty-state">
          <div class="empty-icon">ğŸ””</div>
          <div class="empty-text">ĞÑĞ¼Ğ°Ñˆ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ¸ alerts.<br>Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸ ÑĞ²Ğ¾Ñ Ğ¿ÑŠÑ€Ğ²Ğ¸ alert Ğ¿Ğ¾-Ğ³Ğ¾Ñ€Ğµ!</div>
        </div>`;
      // ĞĞ±Ğ½Ğ¾Ğ²Ğ¸ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ¸Ñ‚Ğµ
      document.querySelectorAll('.sb-val')[0].textContent = '0';
      document.querySelectorAll('.sb-val')[1].textContent = '0';
      return;
    }

    // Ğ ĞµĞ½Ğ´ĞµÑ€Ğ¸Ñ€Ğ°Ğ¹ Ñ€ĞµĞ°Ğ»Ğ½Ğ¸Ñ‚Ğµ alerts
    listEl.innerHTML = result.alerts.map(a => `
      <div class="alert-card ${a.matchesTotal > 0 ? 'has-new' : ''} fade-in" data-id="${a.id}">
        <div class="alert-main">
          <div class="alert-icon-wrap ${a.active ? 'active' : 'paused'}">
            ${getDistrictEmoji(a.district)}
          </div>
          <div class="alert-info">
            <div class="alert-name-row">
              <div class="alert-name">${a.district} â€” Ğ´Ğ¾ ${Number(a.maxPrice).toLocaleString('bg')} Ğ»Ğ²</div>
              ${a.matchesTotal > 0 ? `<span class="alert-new-badge">${a.matchesTotal} ĞĞĞ’Ğ˜</span>` : ''}
            </div>
            <div class="alert-criteria">
              ${a.propertyType !== 'all' ? a.propertyType : 'Ğ’ÑĞ¸Ñ‡ĞºĞ¸ Ñ‚Ğ¸Ğ¿Ğ¾Ğ²Ğµ'} Â· 
              ${a.district} Â· 
              ĞœĞ°ĞºÑ ${Number(a.maxPrice).toLocaleString('bg')} Ğ»Ğ²
              ${a.minSize > 0 ? ' Â· ĞœĞ¸Ğ½ ' + a.minSize + ' Ğ¼Â²' : ''}
            </div>
          </div>
          <div class="alert-stats">
            <div class="alert-stat">
              <div class="alert-stat-val" style="color:${a.matchesTotal > 0 ? 'var(--gold)' : 'rgba(212,204,184,0.3)'}">${a.matchesTotal || 0}</div>
              <div class="alert-stat-label">ĞĞ¾Ğ²Ğ¸</div>
            </div>
          </div>
          <div class="alert-actions">
            <button class="alert-btn" title="${a.active ? 'ĞŸĞ°ÑƒĞ·Ğ°' : 'ĞĞºÑ‚Ğ¸Ğ²Ğ¸Ñ€Ğ°Ğ¹'}" onclick="toggleAlert('${a.id}', ${a.active})">
              ${a.active ? 'â¸' : 'â–¶'}
            </button>
            <button class="alert-btn danger" title="Ğ˜Ğ·Ñ‚Ñ€Ğ¸Ğ¹" onclick="deleteAlertReal('${a.id}', this)">ğŸ—‘ï¸</button>
          </div>
        </div>
      </div>
    `).join('');

    // ĞĞ±Ğ½Ğ¾Ğ²Ğ¸ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ¸
    document.querySelectorAll('.sb-val')[0].textContent = result.alerts.filter(a => a.active).length;
    document.querySelectorAll('.sb-val')[1].textContent = result.alerts.reduce((s,a) => s + (a.matchesTotal||0), 0);
  }

  function getDistrictEmoji(district) {
    const map = {'Ğ›Ğ¾Ğ·ĞµĞ½ĞµÑ†':'ğŸ™ï¸','ĞœĞ»Ğ°Ğ´Ğ¾ÑÑ‚':'ğŸ¢','Ğ’Ğ¸Ñ‚Ğ¾ÑˆĞ°':'ğŸŒ¿','Ğ¡Ğ¸Ğ¼ĞµĞ¾Ğ½Ğ¾Ğ²Ğ¾':'ğŸŒ²','Ğ‘Ğ¾ÑĞ½Ğ°':'ğŸ¡','ĞĞ°Ğ´ĞµĞ¶Ğ´Ğ°':'ğŸ˜ï¸','Ğ›ÑĞ»Ğ¸Ğ½':'ğŸ—ï¸','Ğ¡Ñ‚ÑƒĞ´ĞµĞ½Ñ‚ÑĞºĞ¸':'ğŸ“'};
    return map[district] || 'ğŸ“';
  }

  // Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸ Ğ½Ğ¾Ğ² alert
  async function addAlert() {
    const btn = document.querySelector('.add-btn');
    const district = document.querySelector('.form-select').value.replace(/^[^ ]+ /, '');
    const maxPrice = parseInt(document.querySelectorAll('.form-input')[0]?.value?.replace(/\D/g,'') || '0');
    const propType = document.querySelectorAll('.form-select')[1]?.value?.replace(/^[^ ]+ /, '') || 'all';

    if (!maxPrice || maxPrice < 10000) {
      document.querySelector('.form-input').style.borderColor = 'var(--red)';
      setTimeout(() => document.querySelector('.form-input').style.borderColor = '', 2000);
      return;
    }

    btn.textContent = 'â³ Ğ—Ğ°Ğ¿Ğ°Ğ·Ğ²Ğ°...';
    btn.disabled = true;

    const result = await api('saveAlert', {
      alert: { district, maxPrice, minPrice: 0, propertyType: propType, minSize: 0, maxSize: 0 }
    });

    if (result.success) {
      btn.textContent = 'âœ“ Ğ”Ğ¾Ğ±Ğ°Ğ²ĞµĞ½!';
      btn.style.background = 'var(--green)';
      setTimeout(() => {
        btn.textContent = '+ Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸';
        btn.style.background = '';
        btn.disabled = false;
        loadAlerts(); // ĞŸÑ€ĞµĞ·Ğ°Ñ€ĞµĞ´Ğ¸
      }, 1500);
    } else {
      btn.textContent = result.message || 'Ğ“Ñ€ĞµÑˆĞºĞ°!';
      btn.style.background = 'var(--red)';
      setTimeout(() => { btn.textContent = '+ Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸'; btn.style.background = ''; btn.disabled = false; }, 3000);
    }
  }

  // Ğ˜Ğ·Ñ‚Ñ€Ğ¸Ğ¹ alert
  async function deleteAlertReal(alertId, btn) {
    const card = btn.closest('.alert-card');
    card.style.opacity = '0.5';

    const result = await api('deleteAlert', { alertId });
    if (result.success) {
      card.style.transition = 'all 0.3s';
      card.style.opacity = '0';
      card.style.transform = 'translateX(20px)';
      setTimeout(() => { card.remove(); loadAlerts(); }, 300);
    } else {
      card.style.opacity = '1';
      alert('Ğ“Ñ€ĞµÑˆĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¸Ğ·Ñ‚Ñ€Ğ¸Ğ²Ğ°Ğ½Ğµ');
    }
  }

  // ĞŸĞ°ÑƒĞ·Ğ°/ĞĞºÑ‚Ğ¸Ğ²Ğ¸Ñ€Ğ°Ğ½Ğµ
  async function toggleAlert(alertId, currentActive) {
    // Ğ—Ğ° Ğ¼Ğ¾Ğ¼ĞµĞ½Ñ‚Ğ° ÑĞ°Ğ¼Ğ¾ UI â€” backend toggle Ğ¸Ğ´Ğ²Ğ° Ğ² ÑĞ»ĞµĞ´Ğ²Ğ°Ñ‰Ğ° Ğ²ĞµÑ€ÑĞ¸Ñ
    const card = document.querySelector(`[data-id="${alertId}"]`);
    if (card) {
      const icon = card.querySelector('.alert-icon-wrap');
      if (icon) icon.className = `alert-icon-wrap ${currentActive ? 'paused' : 'active'}`;
    }
  }

  // Ğ—Ğ°Ñ€ĞµĞ´Ğ¸ Ğ¿Ñ€Ğ¸ ÑÑ‚Ğ°Ñ€Ñ‚
  window.addEventListener('load', loadAlerts);

  // MOBILE SIDEBAR
  function toggleSidebar(){
    document.querySelector('.sidebar').classList.toggle('open');
    document.getElementById('burgerBtn').classList.toggle('open');
    document.getElementById('mobileOverlay').classList.toggle('show');
  }
  function closeSidebar(){
    document.querySelector('.sidebar').classList.remove('open');
    document.getElementById('burgerBtn').classList.remove('open');
    document.getElementById('mobileOverlay').classList.remove('show');
  }
  // Close sidebar on nav click (mobile)
  document.querySelectorAll('.nav-item').forEach(a => a.addEventListener('click', closeSidebar));

</script>
</body>
</html>
